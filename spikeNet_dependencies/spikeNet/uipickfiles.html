<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of uipickfiles</title>
  <meta name="keywords" content="uipickfiles">
  <meta name="description" content="uipickfiles: GUI program to select files and/or folders.">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../m2html.css">
  <script type="text/javascript">
    if (top.frames.length == 0) { top.location = "../index.html"; };
  </script>
</head>
<body>
<a name="_top"></a>
<!-- menu.html snr_of_dff_stuff -->
<h1>uipickfiles
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>uipickfiles: GUI program to select files and/or folders.</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>function out = uipickfiles(varargin) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre class="comment">uipickfiles: GUI program to select files and/or folders.

 Syntax:
   files = uipickfiles('PropertyName',PropertyValue,...)

 The current folder can be changed by operating in the file navigator:
 double-clicking on a folder in the list or pressing Enter to move further
 down the tree, using the popup menu, clicking the up arrow button or
 pressing Backspace to move up the tree, typing a path in the box to move
 to any folder or right-clicking (control-click on Mac) on the path box to
 revisit a previously-visited folder.  These folders are listed in order
 of when they were last visited (most recent at the top) and the list is
 saved between calls to uipickfiles.  The list can be cleared or its
 maximum length changed with the items at the bottom of the menu.
 (Windows only: To go to a UNC-named resource you will have to type the
 UNC name in the path box, but all such visited resources will be
 remembered and listed along with the mapped drives.)  The items in the
 file navigator can be sorted by name, modification date or size by
 clicking on the headers, though neither date nor size are displayed.  All
 folders have zero size.

 Files can be added to the list by double-clicking or selecting files
 (non-contiguous selections are possible with the control key) and
 pressing the Add button.  Control-F will select all the files listed in
 the navigator while control-A will select everything (Command instead of
 Control on the Mac).  Since double-clicking a folder will open it,
 folders can be added only by selecting them and pressing the Add button.
 Files/folders in the list can be removed or re-ordered.  Recall button
 will insert into the Selected Files list whatever files were returned the
 last time uipickfiles was run.  When finished, a press of the Done button
 will return the full paths to the selected items in a cell array,
 structure array or character array.  If the Cancel button or the escape
 key is pressed then zero is returned.

 The figure can be moved and resized in the usual way and this position is
 saved and used for subsequent calls to uipickfiles.  The default position
 can be restored by double-clicking in a vacant region of the figure.

 The following optional property/value pairs can be specified as arguments
 to control the indicated behavior:

   Property    Value
   ----------  ----------------------------------------------------------
   FilterSpec  String to specify starting folder and/or file filter.
               Ex:  'C:\bin' will start up in that folder.  '*.txt'
               will list only files ending in '.txt'.  'c:\bin\*.txt' will
               do both.  Default is to start up in the current folder and
               list all files.  Can be changed with the GUI.

   REFilter    String containing a regular expression used to filter the
               file list.  Ex: '\.m$|\.mat$' will list files ending in
               '.m' and '.mat'.  Default is empty string.  Can be used
               with FilterSpec and both filters are applied.  Can be
               changed with the GUI.

   REDirs      Logical flag indicating whether to apply the regular
               expression filter to folder names.  Default is false which
               means that all folders are listed.  Can be changed with the
               GUI.

   Type        Two-column cell array where the first column contains file
               filters and the second column contains descriptions.  If
               this property is specified an additional popup menu will
               appear below the File Filter and selecting an item will put
               that item into the File Filter.  By default, the first item
               will be entered into the File Filter.  For example,
                   { '*.m',   'M-files'   ;
                     '*.mat', 'MAT-files' }.
               Can also be a cell vector of file filter strings in which
               case the descriptions will be the same as the file filters
               themselves.
               Must be a cell array even if there is only one entry.

   Prompt      String containing a prompt appearing in the title bar of
               the figure.  Default is 'Select files'.

   NumFiles    Scalar or vector specifying number of files that must be
               selected.  A scalar specifies an exact value; a two-element
               vector can be used to specify a range, [min max].  The
               function will not return unless the specified number of
               files have been chosen.  Default is [] which accepts any
               number of files.

   Append      Cell array of strings, structure array or char array
               containing a previously returned output from uipickfiles.
               Used to start up program with some entries in the Selected
               Files list.  Any included files that no longer exist will
               not appear.  Default is empty cell array, {}.

   Output      String specifying the data type of the output: 'cell',
               'struct' or 'char'.  Specifying 'cell' produces a cell
               array of strings, the strings containing the full paths of
               the chosen files.  'Struct' returns a structure array like
               the result of the dir function except that the 'name' field
               contains a full path instead of just the file name.  'Char'
               returns a character array of the full paths.  This is most
               useful when you have just one file and want it in a string
               instead of a cell array containing just one string.  The
               default is 'cell'.

 All properties and values are case-insensitive and need only be
 unambiguous.  For example,

   files = uipickfiles('num',1,'out','ch')

 is valid usage.</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../matlabicon.gif)">
</ul>
This function is called by:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="freqExport_gui.html" class="code" title="function varargout = freqExport_gui(varargin)">freqExport_gui</a>	FREQEXPORT_GUI MATLAB code for freqExport_gui.fig</li><li><a href="freq_browser.html" class="code" title="function varargout = freq_browser(varargin)">freq_browser</a>	FREQ_BROWSER MATLAB code for freq_browser.fig</li><li><a href="thresholding_gui.html" class="code" title="function varargout = thresholding_gui(varargin)">thresholding_gui</a>	THRESHOLDING_GUI MATLAB code for thresholding_gui.fig</li></ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="#_sub1" class="code">function add(varargin)</a></li><li><a href="#_sub2" class="code">function remove(varargin)</a></li><li><a href="#_sub3" class="code">function open(varargin)</a></li><li><a href="#_sub4" class="code">function clicknav(varargin)</a></li><li><a href="#_sub5" class="code">function keypressmisc(h,evt)</a></li><li><a href="#_sub6" class="code">function keypressnav(h,evt)</a></li><li><a href="#_sub7" class="code">function keypresslist(h,evt)</a></li><li><a href="#_sub8" class="code">function clickpicks(varargin)</a></li><li><a href="#_sub9" class="code">function recall(varargin)</a></li><li><a href="#_sub10" class="code">function sort_type(h,evt,cb)</a></li><li><a href="#_sub11" class="code">function dirpopup(varargin)</a></li><li><a href="#_sub12" class="code">function dir_up_one(varargin)</a></li><li><a href="#_sub13" class="code">function change_path(varargin)</a></li><li><a href="#_sub14" class="code">function showfullpath(varargin)</a></li><li><a href="#_sub15" class="code">function removedupes(varargin)</a></li><li><a href="#_sub16" class="code">function moveup(varargin)</a></li><li><a href="#_sub17" class="code">function movedown(varargin)</a></li><li><a href="#_sub18" class="code">function togglefilter(varargin)</a></li><li><a href="#_sub19" class="code">function toggle_refiltdirs(varargin)</a></li><li><a href="#_sub20" class="code">function setfilspec(varargin)</a></li><li><a href="#_sub21" class="code">function setrefilter(varargin)</a></li><li><a href="#_sub22" class="code">function filter_type_callback(varargin)</a></li><li><a href="#_sub23" class="code">function done(varargin)</a></li><li><a href="#_sub24" class="code">function cancel(varargin)</a></li><li><a href="#_sub25" class="code">function history_cb(varargin)</a></li><li><a href="#_sub26" class="code">function clear_history(varargin)</a></li><li><a href="#_sub27" class="code">function set_history_size(varargin)</a></li><li><a href="#_sub28" class="code">function resize(varargin)</a></li><li><a href="#_sub29" class="code">function reset_figure_size(varargin)</a></li><li><a href="#_sub30" class="code">function make_history_cm</a></li><li><a href="#_sub31" class="code">function [c,network_vol] = path2cell(p)</a></li><li><a href="#_sub32" class="code">function p = cell2path(c)</a></li><li><a href="#_sub33" class="code">function d = filtered_dir(full_filter,re_filter,filter_both,sort_fcn)</a></li><li><a href="#_sub34" class="code">function [files_sorted,index] = file_sort(files,sort_state)</a></li><li><a href="#_sub35" class="code">function drives = getdrives(other_drives)</a></li><li><a href="#_sub36" class="code">function filenames = annotate_file_names(filenames,dir_listing,fsdata)</a></li><li><a href="#_sub37" class="code">function history = update_history(history,current_dir,time,history_size)</a></li><li><a href="#_sub38" class="code">function success = generate_folder_icon(icon_path)</a></li><li><a href="#_sub39" class="code">function fsdata = set_folder_style(folder_style_pref)</a></li><li><a href="#_sub40" class="code">function prop = parsepropval(prop,varargin)</a></li><li><a href="#_sub41" class="code">function prop_index = match_property(arg,properties)</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function out = uipickfiles(varargin)</a>
0002 <span class="comment">%uipickfiles: GUI program to select files and/or folders.</span>
0003 <span class="comment">%</span>
0004 <span class="comment">% Syntax:</span>
0005 <span class="comment">%   files = uipickfiles('PropertyName',PropertyValue,...)</span>
0006 <span class="comment">%</span>
0007 <span class="comment">% The current folder can be changed by operating in the file navigator:</span>
0008 <span class="comment">% double-clicking on a folder in the list or pressing Enter to move further</span>
0009 <span class="comment">% down the tree, using the popup menu, clicking the up arrow button or</span>
0010 <span class="comment">% pressing Backspace to move up the tree, typing a path in the box to move</span>
0011 <span class="comment">% to any folder or right-clicking (control-click on Mac) on the path box to</span>
0012 <span class="comment">% revisit a previously-visited folder.  These folders are listed in order</span>
0013 <span class="comment">% of when they were last visited (most recent at the top) and the list is</span>
0014 <span class="comment">% saved between calls to uipickfiles.  The list can be cleared or its</span>
0015 <span class="comment">% maximum length changed with the items at the bottom of the menu.</span>
0016 <span class="comment">% (Windows only: To go to a UNC-named resource you will have to type the</span>
0017 <span class="comment">% UNC name in the path box, but all such visited resources will be</span>
0018 <span class="comment">% remembered and listed along with the mapped drives.)  The items in the</span>
0019 <span class="comment">% file navigator can be sorted by name, modification date or size by</span>
0020 <span class="comment">% clicking on the headers, though neither date nor size are displayed.  All</span>
0021 <span class="comment">% folders have zero size.</span>
0022 <span class="comment">%</span>
0023 <span class="comment">% Files can be added to the list by double-clicking or selecting files</span>
0024 <span class="comment">% (non-contiguous selections are possible with the control key) and</span>
0025 <span class="comment">% pressing the Add button.  Control-F will select all the files listed in</span>
0026 <span class="comment">% the navigator while control-A will select everything (Command instead of</span>
0027 <span class="comment">% Control on the Mac).  Since double-clicking a folder will open it,</span>
0028 <span class="comment">% folders can be added only by selecting them and pressing the Add button.</span>
0029 <span class="comment">% Files/folders in the list can be removed or re-ordered.  Recall button</span>
0030 <span class="comment">% will insert into the Selected Files list whatever files were returned the</span>
0031 <span class="comment">% last time uipickfiles was run.  When finished, a press of the Done button</span>
0032 <span class="comment">% will return the full paths to the selected items in a cell array,</span>
0033 <span class="comment">% structure array or character array.  If the Cancel button or the escape</span>
0034 <span class="comment">% key is pressed then zero is returned.</span>
0035 <span class="comment">%</span>
0036 <span class="comment">% The figure can be moved and resized in the usual way and this position is</span>
0037 <span class="comment">% saved and used for subsequent calls to uipickfiles.  The default position</span>
0038 <span class="comment">% can be restored by double-clicking in a vacant region of the figure.</span>
0039 <span class="comment">%</span>
0040 <span class="comment">% The following optional property/value pairs can be specified as arguments</span>
0041 <span class="comment">% to control the indicated behavior:</span>
0042 <span class="comment">%</span>
0043 <span class="comment">%   Property    Value</span>
0044 <span class="comment">%   ----------  ----------------------------------------------------------</span>
0045 <span class="comment">%   FilterSpec  String to specify starting folder and/or file filter.</span>
0046 <span class="comment">%               Ex:  'C:\bin' will start up in that folder.  '*.txt'</span>
0047 <span class="comment">%               will list only files ending in '.txt'.  'c:\bin\*.txt' will</span>
0048 <span class="comment">%               do both.  Default is to start up in the current folder and</span>
0049 <span class="comment">%               list all files.  Can be changed with the GUI.</span>
0050 <span class="comment">%</span>
0051 <span class="comment">%   REFilter    String containing a regular expression used to filter the</span>
0052 <span class="comment">%               file list.  Ex: '\.m$|\.mat$' will list files ending in</span>
0053 <span class="comment">%               '.m' and '.mat'.  Default is empty string.  Can be used</span>
0054 <span class="comment">%               with FilterSpec and both filters are applied.  Can be</span>
0055 <span class="comment">%               changed with the GUI.</span>
0056 <span class="comment">%</span>
0057 <span class="comment">%   REDirs      Logical flag indicating whether to apply the regular</span>
0058 <span class="comment">%               expression filter to folder names.  Default is false which</span>
0059 <span class="comment">%               means that all folders are listed.  Can be changed with the</span>
0060 <span class="comment">%               GUI.</span>
0061 <span class="comment">%</span>
0062 <span class="comment">%   Type        Two-column cell array where the first column contains file</span>
0063 <span class="comment">%               filters and the second column contains descriptions.  If</span>
0064 <span class="comment">%               this property is specified an additional popup menu will</span>
0065 <span class="comment">%               appear below the File Filter and selecting an item will put</span>
0066 <span class="comment">%               that item into the File Filter.  By default, the first item</span>
0067 <span class="comment">%               will be entered into the File Filter.  For example,</span>
0068 <span class="comment">%                   { '*.m',   'M-files'   ;</span>
0069 <span class="comment">%                     '*.mat', 'MAT-files' }.</span>
0070 <span class="comment">%               Can also be a cell vector of file filter strings in which</span>
0071 <span class="comment">%               case the descriptions will be the same as the file filters</span>
0072 <span class="comment">%               themselves.</span>
0073 <span class="comment">%               Must be a cell array even if there is only one entry.</span>
0074 <span class="comment">%</span>
0075 <span class="comment">%   Prompt      String containing a prompt appearing in the title bar of</span>
0076 <span class="comment">%               the figure.  Default is 'Select files'.</span>
0077 <span class="comment">%</span>
0078 <span class="comment">%   NumFiles    Scalar or vector specifying number of files that must be</span>
0079 <span class="comment">%               selected.  A scalar specifies an exact value; a two-element</span>
0080 <span class="comment">%               vector can be used to specify a range, [min max].  The</span>
0081 <span class="comment">%               function will not return unless the specified number of</span>
0082 <span class="comment">%               files have been chosen.  Default is [] which accepts any</span>
0083 <span class="comment">%               number of files.</span>
0084 <span class="comment">%</span>
0085 <span class="comment">%   Append      Cell array of strings, structure array or char array</span>
0086 <span class="comment">%               containing a previously returned output from uipickfiles.</span>
0087 <span class="comment">%               Used to start up program with some entries in the Selected</span>
0088 <span class="comment">%               Files list.  Any included files that no longer exist will</span>
0089 <span class="comment">%               not appear.  Default is empty cell array, {}.</span>
0090 <span class="comment">%</span>
0091 <span class="comment">%   Output      String specifying the data type of the output: 'cell',</span>
0092 <span class="comment">%               'struct' or 'char'.  Specifying 'cell' produces a cell</span>
0093 <span class="comment">%               array of strings, the strings containing the full paths of</span>
0094 <span class="comment">%               the chosen files.  'Struct' returns a structure array like</span>
0095 <span class="comment">%               the result of the dir function except that the 'name' field</span>
0096 <span class="comment">%               contains a full path instead of just the file name.  'Char'</span>
0097 <span class="comment">%               returns a character array of the full paths.  This is most</span>
0098 <span class="comment">%               useful when you have just one file and want it in a string</span>
0099 <span class="comment">%               instead of a cell array containing just one string.  The</span>
0100 <span class="comment">%               default is 'cell'.</span>
0101 <span class="comment">%</span>
0102 <span class="comment">% All properties and values are case-insensitive and need only be</span>
0103 <span class="comment">% unambiguous.  For example,</span>
0104 <span class="comment">%</span>
0105 <span class="comment">%   files = uipickfiles('num',1,'out','ch')</span>
0106 <span class="comment">%</span>
0107 <span class="comment">% is valid usage.</span>
0108 
0109 <span class="comment">% Version: 1.15, 2 March 2012</span>
0110 <span class="comment">% Author:  Douglas M. Schwarz</span>
0111 <span class="comment">% Email:   dmschwarz=ieee*org, dmschwarz=urgrad*rochester*edu</span>
0112 <span class="comment">% Real_email = regexprep(Email,{'=','*'},{'@','.'})</span>
0113 
0114 
0115 <span class="comment">% Define properties and set default values.</span>
0116 prop.filterspec = <span class="string">'*'</span>;
0117 prop.refilter = <span class="string">''</span>;
0118 prop.redirs = false;
0119 prop.type = {};
0120 prop.prompt = <span class="string">'Select files'</span>;
0121 prop.numfiles = [];
0122 prop.append = [];
0123 prop.output = <span class="string">'cell'</span>;
0124 
0125 <span class="comment">% Process inputs and set prop fields.</span>
0126 prop = <a href="#_sub40" class="code" title="subfunction prop = parsepropval(prop,varargin)">parsepropval</a>(prop,varargin{:});
0127 
0128 <span class="comment">% Validate FilterSpec property.</span>
0129 <span class="keyword">if</span> isempty(prop.filterspec)
0130     prop.filterspec = <span class="string">'*'</span>;
0131 <span class="keyword">end</span>
0132 <span class="keyword">if</span> ~ischar(prop.filterspec)
0133     error(<span class="string">'FilterSpec property must contain a string.'</span>)
0134 <span class="keyword">end</span>
0135 
0136 <span class="comment">% Validate REFilter property.</span>
0137 <span class="keyword">if</span> ~ischar(prop.refilter)
0138     error(<span class="string">'REFilter property must contain a string.'</span>)
0139 <span class="keyword">end</span>
0140 
0141 <span class="comment">% Validate REDirs property.</span>
0142 <span class="keyword">if</span> ~isscalar(prop.redirs)
0143     error(<span class="string">'REDirs property must contain a scalar.'</span>)
0144 <span class="keyword">end</span>
0145 
0146 <span class="comment">% Validate Type property.</span>
0147 <span class="keyword">if</span> isempty(prop.type)
0148 <span class="keyword">elseif</span> iscellstr(prop.type) &amp;&amp; isscalar(prop.type)
0149     prop.type = repmat(prop.type(:),1,2);
0150 <span class="keyword">elseif</span> iscellstr(prop.type) &amp;&amp; size(prop.type,2) == 2
0151 <span class="keyword">else</span>
0152     error([<span class="string">'Type property must be empty or a cellstr vector or '</span>,<span class="keyword">...</span>
0153         <span class="string">'a 2-column cellstr matrix.'</span>])
0154 <span class="keyword">end</span>
0155 
0156 <span class="comment">% Validate Prompt property.</span>
0157 <span class="keyword">if</span> ~ischar(prop.prompt)
0158     error(<span class="string">'Prompt property must contain a string.'</span>)
0159 <span class="keyword">end</span>
0160 
0161 <span class="comment">% Validate NumFiles property.</span>
0162 <span class="keyword">if</span> numel(prop.numfiles) &gt; 2 || any(prop.numfiles &lt; 0)
0163     error(<span class="string">'NumFiles must be empty, a scalar or two-element vector.'</span>)
0164 <span class="keyword">end</span>
0165 prop.numfiles = unique(prop.numfiles);
0166 <span class="keyword">if</span> isequal(prop.numfiles,1)
0167     numstr = <span class="string">'Select exactly 1 file.'</span>;
0168 <span class="keyword">elseif</span> length(prop.numfiles) == 1
0169     numstr = sprintf(<span class="string">'Select exactly %d items.'</span>,prop.numfiles);
0170 <span class="keyword">else</span>
0171     numstr = sprintf(<span class="string">'Select %d to %d items.'</span>,prop.numfiles);
0172 <span class="keyword">end</span>
0173 
0174 <span class="comment">% Validate Append property and initialize pick data.</span>
0175 <span class="keyword">if</span> isstruct(prop.append) &amp;&amp; isfield(prop.append,<span class="string">'name'</span>)
0176     prop.append = {prop.append.name};
0177 <span class="keyword">elseif</span> ischar(prop.append)
0178     prop.append = cellstr(prop.append);
0179 <span class="keyword">end</span>
0180 <span class="keyword">if</span> isempty(prop.append)
0181     file_picks = {};
0182     full_file_picks = {};
0183     dir_picks = dir(<span class="string">' '</span>);  <span class="comment">% Create empty directory structure.</span>
0184 <span class="keyword">elseif</span> iscellstr(prop.append) &amp;&amp; isvector(prop.append)
0185     num_items = length(prop.append);
0186     file_picks = cell(1,num_items);
0187     full_file_picks = cell(1,num_items);
0188     dir_fn = fieldnames(dir(<span class="string">' '</span>));
0189     dir_picks = repmat(cell2struct(cell(length(dir_fn),1),dir_fn(:)),<span class="keyword">...</span>
0190         num_items,1);
0191     <span class="keyword">for</span> item = 1:num_items
0192         <span class="keyword">if</span> exist(prop.append{item},<span class="string">'dir'</span>) &amp;&amp; <span class="keyword">...</span>
0193                 ~any(strcmp(full_file_picks,prop.append{item}))
0194             full_file_picks{item} = prop.append{item};
0195             [unused,fn,ext] = fileparts(prop.append{item});
0196             file_picks{item} = [fn,ext];
0197             temp = dir(fullfile(prop.append{item},<span class="string">'..'</span>));
0198             <span class="keyword">if</span> ispc || ismac
0199                 thisdir = strcmpi({temp.name},[fn,ext]);
0200             <span class="keyword">else</span>
0201                 thisdir = strcmp({temp.name},[fn,ext]);
0202             <span class="keyword">end</span>
0203             dir_picks(item) = temp(thisdir);
0204             dir_picks(item).name = prop.append{item};
0205         <span class="keyword">elseif</span> exist(prop.append{item},<span class="string">'file'</span>) &amp;&amp; <span class="keyword">...</span>
0206                 ~any(strcmp(full_file_picks,prop.append{item}))
0207             full_file_picks{item} = prop.append{item};
0208             [unused,fn,ext] = fileparts(prop.append{item});
0209             file_picks{item} = [fn,ext];
0210             dir_picks(item) = dir(prop.append{item});
0211             dir_picks(item).name = prop.append{item};
0212         <span class="keyword">else</span>
0213             <span class="keyword">continue</span>
0214         <span class="keyword">end</span>
0215     <span class="keyword">end</span>
0216     <span class="comment">% Remove items which no longer exist.</span>
0217     missing = cellfun(@isempty,full_file_picks);
0218     full_file_picks(missing) = [];
0219     file_picks(missing) = [];
0220     dir_picks(missing) = [];
0221 <span class="keyword">else</span>
0222     error(<span class="string">'Append must be a cell, struct or char array.'</span>)
0223 <span class="keyword">end</span>
0224 
0225 <span class="comment">% Validate Output property.</span>
0226 legal_outputs = {<span class="string">'cell'</span>,<span class="string">'struct'</span>,<span class="string">'char'</span>};
0227 out_idx = find(strncmpi(prop.output,legal_outputs,length(prop.output)));
0228 <span class="keyword">if</span> length(out_idx) == 1
0229     prop.output = legal_outputs{out_idx};
0230 <span class="keyword">else</span>
0231     error([<span class="string">'Value of ''Output'' property, ''%s'', is illegal or '</span><span class="keyword">...</span>
0232         <span class="string">'ambiguous.'</span>],prop.output)
0233 <span class="keyword">end</span>
0234 
0235 
0236 <span class="comment">% Set style preference for display of folders.</span>
0237 <span class="comment">%   1 =&gt; folder icon before and filesep after</span>
0238 <span class="comment">%   2 =&gt; bullet before and filesep after</span>
0239 <span class="comment">%   3 =&gt; filesep after only</span>
0240 folder_style_pref = 1;
0241 fsdata = <a href="#_sub39" class="code" title="subfunction fsdata = set_folder_style(folder_style_pref)">set_folder_style</a>(folder_style_pref);
0242 
0243 <span class="comment">% Initialize file lists.</span>
0244 <span class="keyword">if</span> exist(prop.filterspec,<span class="string">'dir'</span>)
0245     current_dir = prop.filterspec;
0246     filter = <span class="string">'*'</span>;
0247 <span class="keyword">else</span>
0248     [current_dir,f,e] = fileparts(prop.filterspec);
0249     filter = [f,e];
0250 <span class="keyword">end</span>
0251 <span class="keyword">if</span> isempty(current_dir)
0252     current_dir = pwd;
0253 <span class="keyword">end</span>
0254 <span class="keyword">if</span> isempty(filter)
0255     filter = <span class="string">'*'</span>;
0256 <span class="keyword">end</span>
0257 re_filter = prop.refilter;
0258 full_filter = fullfile(current_dir,filter);
0259 network_volumes = {};
0260 [path_cell,new_network_vol] = <a href="#_sub31" class="code" title="subfunction [c,network_vol] = path2cell(p)">path2cell</a>(current_dir);
0261 <span class="keyword">if</span> exist(new_network_vol,<span class="string">'dir'</span>)
0262     network_volumes = unique([network_volumes,{new_network_vol}]);
0263 <span class="keyword">end</span>
0264 fdir = <a href="#_sub33" class="code" title="subfunction d = filtered_dir(full_filter,re_filter,filter_both,sort_fcn)">filtered_dir</a>(full_filter,re_filter,prop.redirs,<span class="keyword">...</span>
0265     @(x)<a href="#_sub34" class="code" title="subfunction [files_sorted,index] = file_sort(files,sort_state)">file_sort</a>(x,[1 0 0]));
0266 filenames = {fdir.name}';
0267 filenames = <a href="#_sub36" class="code" title="subfunction filenames = annotate_file_names(filenames,dir_listing,fsdata)">annotate_file_names</a>(filenames,fdir,fsdata);
0268 
0269 <span class="comment">% Initialize some data.</span>
0270 show_full_path = false;
0271 nodupes = true;
0272 
0273 <span class="comment">% Get history preferences and set history.</span>
0274 history = getpref(<span class="string">'uipickfiles'</span>,<span class="string">'history'</span>,<span class="keyword">...</span>
0275     struct(<span class="string">'name'</span>,current_dir,<span class="string">'time'</span>,now));
0276 default_history_size = 15;
0277 history_size = getpref(<span class="string">'uipickfiles'</span>,<span class="string">'history_size'</span>,default_history_size);
0278 history = <a href="#_sub37" class="code" title="subfunction history = update_history(history,current_dir,time,history_size)">update_history</a>(history,current_dir,now,history_size);
0279 
0280 <span class="comment">% Get figure position preference and create figure.</span>
0281 gray = get(0,<span class="string">'DefaultUIControlBackgroundColor'</span>);
0282 <span class="keyword">if</span> ispref(<span class="string">'uipickfiles'</span>,<span class="string">'figure_position'</span>);
0283     fig_pos = getpref(<span class="string">'uipickfiles'</span>,<span class="string">'figure_position'</span>);
0284     fig = figure(<span class="string">'Position'</span>,fig_pos,<span class="keyword">...</span>
0285         <span class="string">'Color'</span>,gray,<span class="keyword">...</span>
0286         <span class="string">'MenuBar'</span>,<span class="string">'none'</span>,<span class="keyword">...</span>
0287         <span class="string">'WindowStyle'</span>,<span class="string">'modal'</span>,<span class="keyword">...</span>
0288         <span class="string">'Resize'</span>,<span class="string">'on'</span>,<span class="keyword">...</span>
0289         <span class="string">'NumberTitle'</span>,<span class="string">'off'</span>,<span class="keyword">...</span>
0290         <span class="string">'Name'</span>,prop.prompt,<span class="keyword">...</span>
0291         <span class="string">'IntegerHandle'</span>,<span class="string">'off'</span>,<span class="keyword">...</span>
0292         <span class="string">'CloseRequestFcn'</span>,@<a href="#_sub24" class="code" title="subfunction cancel(varargin)">cancel</a>,<span class="keyword">...</span>
0293         <span class="string">'ButtonDownFcn'</span>,@<a href="#_sub29" class="code" title="subfunction reset_figure_size(varargin)">reset_figure_size</a>,<span class="keyword">...</span>
0294         <span class="string">'KeyPressFcn'</span>,@<a href="#_sub5" class="code" title="subfunction keypressmisc(h,evt) ">keypressmisc</a>,<span class="keyword">...</span>
0295         <span class="string">'Visible'</span>,<span class="string">'off'</span>);
0296 <span class="keyword">else</span>
0297     fig_pos = [0 0 740 494];
0298     fig = figure(<span class="string">'Position'</span>,fig_pos,<span class="keyword">...</span>
0299         <span class="string">'Color'</span>,gray,<span class="keyword">...</span>
0300         <span class="string">'MenuBar'</span>,<span class="string">'none'</span>,<span class="keyword">...</span>
0301         <span class="string">'WindowStyle'</span>,<span class="string">'modal'</span>,<span class="keyword">...</span>
0302         <span class="string">'Resize'</span>,<span class="string">'on'</span>,<span class="keyword">...</span>
0303         <span class="string">'NumberTitle'</span>,<span class="string">'off'</span>,<span class="keyword">...</span>
0304         <span class="string">'Name'</span>,prop.prompt,<span class="keyword">...</span>
0305         <span class="string">'IntegerHandle'</span>,<span class="string">'off'</span>,<span class="keyword">...</span>
0306         <span class="string">'CloseRequestFcn'</span>,@<a href="#_sub24" class="code" title="subfunction cancel(varargin)">cancel</a>,<span class="keyword">...</span>
0307         <span class="string">'CreateFcn'</span>,{@movegui,<span class="string">'center'</span>},<span class="keyword">...</span>
0308         <span class="string">'ButtonDownFcn'</span>,@<a href="#_sub29" class="code" title="subfunction reset_figure_size(varargin)">reset_figure_size</a>,<span class="keyword">...</span>
0309         <span class="string">'KeyPressFcn'</span>,@<a href="#_sub5" class="code" title="subfunction keypressmisc(h,evt) ">keypressmisc</a>,<span class="keyword">...</span>
0310         <span class="string">'Visible'</span>,<span class="string">'off'</span>);
0311 <span class="keyword">end</span>
0312 
0313 <span class="comment">% Set system-dependent items.</span>
0314 <span class="keyword">if</span> ismac
0315     set(fig,<span class="string">'DefaultUIControlFontName'</span>,<span class="string">'Lucida Grande'</span>)
0316     set(fig,<span class="string">'DefaultUIControlFontSize'</span>,9)
0317     sort_ctrl_size = 8;
0318     mod_key = <span class="string">'command'</span>;
0319     action = <span class="string">'Control-click'</span>;
0320 <span class="keyword">elseif</span> ispc
0321     set(fig,<span class="string">'DefaultUIControlFontName'</span>,<span class="string">'Tahoma'</span>)
0322     set(fig,<span class="string">'DefaultUIControlFontSize'</span>,8)
0323     sort_ctrl_size = 7;
0324     mod_key = <span class="string">'control'</span>;
0325     action = <span class="string">'Right-click'</span>;
0326 <span class="keyword">else</span>
0327     sort_ctrl_size = get(fig,<span class="string">'DefaultUIControlFontSize'</span>) - 1;
0328     mod_key = <span class="string">'control'</span>;
0329     action = <span class="string">'Right-click'</span>;
0330 <span class="keyword">end</span>
0331 
0332 <span class="comment">% Create uicontrols.</span>
0333 frame1 = uicontrol(<span class="string">'Style'</span>,<span class="string">'frame'</span>,<span class="keyword">...</span>
0334     <span class="string">'Position'</span>,[255 260 110 70]);
0335 frame2 = uicontrol(<span class="string">'Style'</span>,<span class="string">'frame'</span>,<span class="keyword">...</span>
0336     <span class="string">'Position'</span>,[275 135 110 100]);
0337 
0338 navlist = uicontrol(<span class="string">'Style'</span>,<span class="string">'listbox'</span>,<span class="keyword">...</span>
0339     <span class="string">'Position'</span>,[10 10 250 320],<span class="keyword">...</span>
0340     <span class="string">'String'</span>,filenames,<span class="keyword">...</span>
0341     <span class="string">'Value'</span>,[],<span class="keyword">...</span>
0342     <span class="string">'BackgroundColor'</span>,<span class="string">'w'</span>,<span class="keyword">...</span>
0343     <span class="string">'Callback'</span>,@<a href="#_sub4" class="code" title="subfunction clicknav(varargin)">clicknav</a>,<span class="keyword">...</span>
0344     <span class="string">'KeyPressFcn'</span>,@<a href="#_sub6" class="code" title="subfunction keypressnav(h,evt) ">keypressnav</a>,<span class="keyword">...</span>
0345     <span class="string">'Max'</span>,2);
0346 
0347 tri_up = repmat([1 1 1 1 0 1 1 1 1;1 1 1 0 0 0 1 1 1;1 1 0 0 0 0 0 1 1;<span class="keyword">...</span>
0348     1 0 0 0 0 0 0 0 1],[1 1 3]);
0349 tri_up(tri_up == 1) = NaN;
0350 tri_down = tri_up(end:-1:1,:,:);
0351 tri_null = NaN(4,9,3);
0352 tri_icon = {tri_down,tri_null,tri_up};
0353 sort_state = [1 0 0];
0354 last_sort_state = [1 1 1];
0355 sort_cb = zeros(1,3);
0356 sort_cb(1) = uicontrol(<span class="string">'Style'</span>,<span class="string">'checkbox'</span>,<span class="keyword">...</span>
0357     <span class="string">'Position'</span>,[15 331 70 15],<span class="keyword">...</span>
0358     <span class="string">'String'</span>,<span class="string">'Name'</span>,<span class="keyword">...</span>
0359     <span class="string">'FontSize'</span>,sort_ctrl_size,<span class="keyword">...</span>
0360     <span class="string">'Value'</span>,sort_state(1),<span class="keyword">...</span>
0361     <span class="string">'CData'</span>,tri_icon{sort_state(1)+2},<span class="keyword">...</span>
0362     <span class="string">'KeyPressFcn'</span>,@<a href="#_sub5" class="code" title="subfunction keypressmisc(h,evt) ">keypressmisc</a>,<span class="keyword">...</span>
0363     <span class="string">'Callback'</span>,{@<a href="#_sub10" class="code" title="subfunction sort_type(h,evt,cb) ">sort_type</a>,1});
0364 sort_cb(2) = uicontrol(<span class="string">'Style'</span>,<span class="string">'checkbox'</span>,<span class="keyword">...</span>
0365     <span class="string">'Position'</span>,[85 331 70 15],<span class="keyword">...</span>
0366     <span class="string">'String'</span>,<span class="string">'Date'</span>,<span class="keyword">...</span>
0367     <span class="string">'FontSize'</span>,sort_ctrl_size,<span class="keyword">...</span>
0368     <span class="string">'Value'</span>,sort_state(2),<span class="keyword">...</span>
0369     <span class="string">'CData'</span>,tri_icon{sort_state(2)+2},<span class="keyword">...</span>
0370     <span class="string">'KeyPressFcn'</span>,@<a href="#_sub5" class="code" title="subfunction keypressmisc(h,evt) ">keypressmisc</a>,<span class="keyword">...</span>
0371     <span class="string">'Callback'</span>,{@<a href="#_sub10" class="code" title="subfunction sort_type(h,evt,cb) ">sort_type</a>,2});
0372 sort_cb(3) = uicontrol(<span class="string">'Style'</span>,<span class="string">'checkbox'</span>,<span class="keyword">...</span>
0373     <span class="string">'Position'</span>,[155 331 70 15],<span class="keyword">...</span>
0374     <span class="string">'String'</span>,<span class="string">'Size'</span>,<span class="keyword">...</span>
0375     <span class="string">'FontSize'</span>,sort_ctrl_size,<span class="keyword">...</span>
0376     <span class="string">'Value'</span>,sort_state(3),<span class="keyword">...</span>
0377     <span class="string">'CData'</span>,tri_icon{sort_state(3)+2},<span class="keyword">...</span>
0378     <span class="string">'KeyPressFcn'</span>,@<a href="#_sub5" class="code" title="subfunction keypressmisc(h,evt) ">keypressmisc</a>,<span class="keyword">...</span>
0379     <span class="string">'Callback'</span>,{@<a href="#_sub10" class="code" title="subfunction sort_type(h,evt,cb) ">sort_type</a>,3});
0380 
0381 pickslist = uicontrol(<span class="string">'Style'</span>,<span class="string">'listbox'</span>,<span class="keyword">...</span>
0382     <span class="string">'Position'</span>,[380 10 350 320],<span class="keyword">...</span>
0383     <span class="string">'String'</span>,file_picks,<span class="keyword">...</span>
0384     <span class="string">'BackgroundColor'</span>,<span class="string">'w'</span>,<span class="keyword">...</span>
0385     <span class="string">'Callback'</span>,@<a href="#_sub8" class="code" title="subfunction clickpicks(varargin)">clickpicks</a>,<span class="keyword">...</span>
0386     <span class="string">'KeyPressFcn'</span>,@<a href="#_sub7" class="code" title="subfunction keypresslist(h,evt) ">keypresslist</a>,<span class="keyword">...</span>
0387     <span class="string">'Max'</span>,2,<span class="keyword">...</span>
0388     <span class="string">'Value'</span>,[]);
0389 
0390 openbut = uicontrol(<span class="string">'Style'</span>,<span class="string">'pushbutton'</span>,<span class="keyword">...</span>
0391     <span class="string">'Position'</span>,[270 300 80 20],<span class="keyword">...</span>
0392     <span class="string">'String'</span>,<span class="string">'Open'</span>,<span class="keyword">...</span>
0393     <span class="string">'Enable'</span>,<span class="string">'off'</span>,<span class="keyword">...</span>
0394     <span class="string">'KeyPressFcn'</span>,@<a href="#_sub5" class="code" title="subfunction keypressmisc(h,evt) ">keypressmisc</a>,<span class="keyword">...</span>
0395     <span class="string">'Callback'</span>,@<a href="#_sub3" class="code" title="subfunction open(varargin)">open</a>);
0396 
0397 arrow = [ <span class="keyword">...</span>
0398     <span class="string">'        1   '</span>;
0399     <span class="string">'        10  '</span>;
0400     <span class="string">'         10 '</span>;
0401     <span class="string">'000000000000'</span>;
0402     <span class="string">'         10 '</span>;
0403     <span class="string">'        10  '</span>;
0404     <span class="string">'        1   '</span>];
0405 cmap = NaN(128,3);
0406 cmap(double(<span class="string">'10'</span>),:) = [0.5 0.5 0.5;0 0 0];
0407 arrow_im = NaN(7,76,3);
0408 arrow_im(:,45:56,:) = ind2rgb(double(arrow),cmap);
0409 addbut = uicontrol(<span class="string">'Style'</span>,<span class="string">'pushbutton'</span>,<span class="keyword">...</span>
0410     <span class="string">'Position'</span>,[270 270 80 20],<span class="keyword">...</span>
0411     <span class="string">'String'</span>,<span class="string">'Add    '</span>,<span class="keyword">...</span>
0412     <span class="string">'Enable'</span>,<span class="string">'off'</span>,<span class="keyword">...</span>
0413     <span class="string">'CData'</span>,arrow_im,<span class="keyword">...</span>
0414     <span class="string">'KeyPressFcn'</span>,@<a href="#_sub5" class="code" title="subfunction keypressmisc(h,evt) ">keypressmisc</a>,<span class="keyword">...</span>
0415     <span class="string">'Callback'</span>,@<a href="#_sub1" class="code" title="subfunction add(varargin)">add</a>);
0416 
0417 removebut = uicontrol(<span class="string">'Style'</span>,<span class="string">'pushbutton'</span>,<span class="keyword">...</span>
0418     <span class="string">'Position'</span>,[290 205 80 20],<span class="keyword">...</span>
0419     <span class="string">'String'</span>,<span class="string">'Remove'</span>,<span class="keyword">...</span>
0420     <span class="string">'Enable'</span>,<span class="string">'off'</span>,<span class="keyword">...</span>
0421     <span class="string">'KeyPressFcn'</span>,@<a href="#_sub5" class="code" title="subfunction keypressmisc(h,evt) ">keypressmisc</a>,<span class="keyword">...</span>
0422     <span class="string">'Callback'</span>,@<a href="#_sub2" class="code" title="subfunction remove(varargin)">remove</a>);
0423 moveupbut = uicontrol(<span class="string">'Style'</span>,<span class="string">'pushbutton'</span>,<span class="keyword">...</span>
0424     <span class="string">'Position'</span>,[290 175 80 20],<span class="keyword">...</span>
0425     <span class="string">'String'</span>,<span class="string">'Move Up'</span>,<span class="keyword">...</span>
0426     <span class="string">'Enable'</span>,<span class="string">'off'</span>,<span class="keyword">...</span>
0427     <span class="string">'KeyPressFcn'</span>,@<a href="#_sub5" class="code" title="subfunction keypressmisc(h,evt) ">keypressmisc</a>,<span class="keyword">...</span>
0428     <span class="string">'Callback'</span>,@<a href="#_sub16" class="code" title="subfunction moveup(varargin)">moveup</a>);
0429 movedownbut = uicontrol(<span class="string">'Style'</span>,<span class="string">'pushbutton'</span>,<span class="keyword">...</span>
0430     <span class="string">'Position'</span>,[290 145 80 20],<span class="keyword">...</span>
0431     <span class="string">'String'</span>,<span class="string">'Move Down'</span>,<span class="keyword">...</span>
0432     <span class="string">'Enable'</span>,<span class="string">'off'</span>,<span class="keyword">...</span>
0433     <span class="string">'KeyPressFcn'</span>,@<a href="#_sub5" class="code" title="subfunction keypressmisc(h,evt) ">keypressmisc</a>,<span class="keyword">...</span>
0434     <span class="string">'Callback'</span>,@<a href="#_sub17" class="code" title="subfunction movedown(varargin)">movedown</a>);
0435 
0436 dir_popup = uicontrol(<span class="string">'Style'</span>,<span class="string">'popupmenu'</span>,<span class="keyword">...</span>
0437     <span class="string">'Position'</span>,[10 350 225 20],<span class="keyword">...</span>
0438     <span class="string">'BackgroundColor'</span>,<span class="string">'w'</span>,<span class="keyword">...</span>
0439     <span class="string">'String'</span>,path_cell,<span class="keyword">...</span>
0440     <span class="string">'Value'</span>,length(path_cell),<span class="keyword">...</span>
0441     <span class="string">'KeyPressFcn'</span>,@<a href="#_sub5" class="code" title="subfunction keypressmisc(h,evt) ">keypressmisc</a>,<span class="keyword">...</span>
0442     <span class="string">'Callback'</span>,@<a href="#_sub11" class="code" title="subfunction dirpopup(varargin)">dirpopup</a>);
0443 
0444 uparrow = [ <span class="keyword">...</span>
0445     <span class="string">'  0     '</span>;
0446     <span class="string">' 000    '</span>;
0447     <span class="string">'00000   '</span>;
0448     <span class="string">'  0     '</span>;
0449     <span class="string">'  0     '</span>;
0450     <span class="string">'  0     '</span>;
0451     <span class="string">'  000000'</span>];
0452 cmap = NaN(128,3);
0453 cmap(double(<span class="string">'0'</span>),:) = [0 0 0];
0454 uparrow_im = ind2rgb(double(uparrow),cmap);
0455 up_dir_but = uicontrol(<span class="string">'Style'</span>,<span class="string">'pushbutton'</span>,<span class="keyword">...</span>
0456     <span class="string">'Position'</span>,[240 350 20 20],<span class="keyword">...</span>
0457     <span class="string">'CData'</span>,uparrow_im,<span class="keyword">...</span>
0458     <span class="string">'KeyPressFcn'</span>,@<a href="#_sub5" class="code" title="subfunction keypressmisc(h,evt) ">keypressmisc</a>,<span class="keyword">...</span>
0459     <span class="string">'Callback'</span>,@<a href="#_sub12" class="code" title="subfunction dir_up_one(varargin)">dir_up_one</a>,<span class="keyword">...</span>
0460     <span class="string">'ToolTip'</span>,<span class="string">'Go to parent folder'</span>);
0461 <span class="keyword">if</span> length(path_cell) &gt; 1
0462     set(up_dir_but',<span class="string">'Enable'</span>,<span class="string">'on'</span>)
0463 <span class="keyword">else</span>
0464     set(up_dir_but',<span class="string">'Enable'</span>,<span class="string">'off'</span>)
0465 <span class="keyword">end</span>
0466 
0467 hist_cm = uicontextmenu;
0468 pathbox = uicontrol(<span class="string">'Style'</span>,<span class="string">'edit'</span>,<span class="keyword">...</span>
0469     <span class="string">'Position'</span>,[10 375 250 26],<span class="keyword">...</span>
0470     <span class="string">'BackgroundColor'</span>,<span class="string">'w'</span>,<span class="keyword">...</span>
0471     <span class="string">'String'</span>,current_dir,<span class="keyword">...</span>
0472     <span class="string">'HorizontalAlignment'</span>,<span class="string">'left'</span>,<span class="keyword">...</span>
0473     <span class="string">'TooltipString'</span>,[action,<span class="string">' to display folder history'</span>],<span class="keyword">...</span>
0474     <span class="string">'KeyPressFcn'</span>,@<a href="#_sub5" class="code" title="subfunction keypressmisc(h,evt) ">keypressmisc</a>,<span class="keyword">...</span>
0475     <span class="string">'Callback'</span>,@<a href="#_sub13" class="code" title="subfunction change_path(varargin)">change_path</a>,<span class="keyword">...</span>
0476     <span class="string">'UIContextMenu'</span>,hist_cm);
0477 label1 = uicontrol(<span class="string">'Style'</span>,<span class="string">'text'</span>,<span class="keyword">...</span>
0478     <span class="string">'Position'</span>,[10 401 250 16],<span class="keyword">...</span>
0479     <span class="string">'String'</span>,<span class="string">'Current Folder'</span>,<span class="keyword">...</span>
0480     <span class="string">'HorizontalAlignment'</span>,<span class="string">'center'</span>,<span class="keyword">...</span>
0481     <span class="string">'TooltipString'</span>,[action,<span class="string">' to display folder history'</span>],<span class="keyword">...</span>
0482     <span class="string">'UIContextMenu'</span>,hist_cm);
0483 hist_menus = [];
0484 <a href="#_sub30" class="code" title="subfunction make_history_cm">make_history_cm</a>()
0485 
0486 label2 = uicontrol(<span class="string">'Style'</span>,<span class="string">'text'</span>,<span class="keyword">...</span>
0487     <span class="string">'Position'</span>,[10 440+36 80 17],<span class="keyword">...</span>
0488     <span class="string">'String'</span>,<span class="string">'File Filter'</span>,<span class="keyword">...</span>
0489     <span class="string">'HorizontalAlignment'</span>,<span class="string">'left'</span>);
0490 label3 = uicontrol(<span class="string">'Style'</span>,<span class="string">'text'</span>,<span class="keyword">...</span>
0491     <span class="string">'Position'</span>,[100 440+36 160 17],<span class="keyword">...</span>
0492     <span class="string">'String'</span>,<span class="string">'Reg. Exp. Filter'</span>,<span class="keyword">...</span>
0493     <span class="string">'HorizontalAlignment'</span>,<span class="string">'left'</span>);
0494 showallfiles = uicontrol(<span class="string">'Style'</span>,<span class="string">'checkbox'</span>,<span class="keyword">...</span>
0495     <span class="string">'Position'</span>,[270 420+32 110 20],<span class="keyword">...</span>
0496     <span class="string">'String'</span>,<span class="string">'Show All Files'</span>,<span class="keyword">...</span>
0497     <span class="string">'Value'</span>,0,<span class="keyword">...</span>
0498     <span class="string">'HorizontalAlignment'</span>,<span class="string">'left'</span>,<span class="keyword">...</span>
0499     <span class="string">'KeyPressFcn'</span>,@<a href="#_sub5" class="code" title="subfunction keypressmisc(h,evt) ">keypressmisc</a>,<span class="keyword">...</span>
0500     <span class="string">'Callback'</span>,@<a href="#_sub18" class="code" title="subfunction togglefilter(varargin)">togglefilter</a>);
0501 refilterdirs = uicontrol(<span class="string">'Style'</span>,<span class="string">'checkbox'</span>,<span class="keyword">...</span>
0502     <span class="string">'Position'</span>,[270 420+10 100 20],<span class="keyword">...</span>
0503     <span class="string">'String'</span>,<span class="string">'RE Filter Dirs'</span>,<span class="keyword">...</span>
0504     <span class="string">'Value'</span>,prop.redirs,<span class="keyword">...</span>
0505     <span class="string">'HorizontalAlignment'</span>,<span class="string">'left'</span>,<span class="keyword">...</span>
0506     <span class="string">'KeyPressFcn'</span>,@<a href="#_sub5" class="code" title="subfunction keypressmisc(h,evt) ">keypressmisc</a>,<span class="keyword">...</span>
0507     <span class="string">'Callback'</span>,@<a href="#_sub19" class="code" title="subfunction toggle_refiltdirs(varargin)">toggle_refiltdirs</a>);
0508 filter_ed = uicontrol(<span class="string">'Style'</span>,<span class="string">'edit'</span>,<span class="keyword">...</span>
0509     <span class="string">'Position'</span>,[10 420+30 80 26],<span class="keyword">...</span>
0510     <span class="string">'BackgroundColor'</span>,<span class="string">'w'</span>,<span class="keyword">...</span>
0511     <span class="string">'String'</span>,filter,<span class="keyword">...</span>
0512     <span class="string">'HorizontalAlignment'</span>,<span class="string">'left'</span>,<span class="keyword">...</span>
0513     <span class="string">'KeyPressFcn'</span>,@<a href="#_sub5" class="code" title="subfunction keypressmisc(h,evt) ">keypressmisc</a>,<span class="keyword">...</span>
0514     <span class="string">'Callback'</span>,@<a href="#_sub20" class="code" title="subfunction setfilspec(varargin)">setfilspec</a>);
0515 refilter_ed = uicontrol(<span class="string">'Style'</span>,<span class="string">'edit'</span>,<span class="keyword">...</span>
0516     <span class="string">'Position'</span>,[100 420+30 160 26],<span class="keyword">...</span>
0517     <span class="string">'BackgroundColor'</span>,<span class="string">'w'</span>,<span class="keyword">...</span>
0518     <span class="string">'String'</span>,re_filter,<span class="keyword">...</span>
0519     <span class="string">'HorizontalAlignment'</span>,<span class="string">'left'</span>,<span class="keyword">...</span>
0520     <span class="string">'KeyPressFcn'</span>,@<a href="#_sub5" class="code" title="subfunction keypressmisc(h,evt) ">keypressmisc</a>,<span class="keyword">...</span>
0521     <span class="string">'Callback'</span>,@<a href="#_sub21" class="code" title="subfunction setrefilter(varargin)">setrefilter</a>);
0522 
0523 type_value = 1;
0524 type_popup = uicontrol(<span class="string">'Style'</span>,<span class="string">'popupmenu'</span>,<span class="keyword">...</span>
0525     <span class="string">'Position'</span>,[10 422 250 20],<span class="keyword">...</span>
0526     <span class="string">'String'</span>,<span class="string">''</span>,<span class="keyword">...</span>
0527     <span class="string">'BackgroundColor'</span>,<span class="string">'w'</span>,<span class="keyword">...</span>
0528     <span class="string">'Value'</span>,type_value,<span class="keyword">...</span>
0529     <span class="string">'KeyPressFcn'</span>,@<a href="#_sub5" class="code" title="subfunction keypressmisc(h,evt) ">keypressmisc</a>,<span class="keyword">...</span>
0530     <span class="string">'Callback'</span>,@<a href="#_sub22" class="code" title="subfunction filter_type_callback(varargin)">filter_type_callback</a>,<span class="keyword">...</span>
0531     <span class="string">'Visible'</span>,<span class="string">'off'</span>);
0532 <span class="keyword">if</span> ~isempty(prop.type)
0533     set(filter_ed,<span class="string">'String'</span>,prop.type{type_value,1})
0534     <a href="#_sub20" class="code" title="subfunction setfilspec(varargin)">setfilspec</a>()
0535     set(type_popup,<span class="string">'String'</span>,prop.type(:,2),<span class="string">'Visible'</span>,<span class="string">'on'</span>)
0536 <span class="keyword">end</span>
0537 
0538 viewfullpath = uicontrol(<span class="string">'Style'</span>,<span class="string">'checkbox'</span>,<span class="keyword">...</span>
0539     <span class="string">'Position'</span>,[380 335 230 20],<span class="keyword">...</span>
0540     <span class="string">'String'</span>,<span class="string">'Show full paths'</span>,<span class="keyword">...</span>
0541     <span class="string">'Value'</span>,show_full_path,<span class="keyword">...</span>
0542     <span class="string">'HorizontalAlignment'</span>,<span class="string">'left'</span>,<span class="keyword">...</span>
0543     <span class="string">'KeyPressFcn'</span>,@<a href="#_sub5" class="code" title="subfunction keypressmisc(h,evt) ">keypressmisc</a>,<span class="keyword">...</span>
0544     <span class="string">'Callback'</span>,@<a href="#_sub14" class="code" title="subfunction showfullpath(varargin)">showfullpath</a>);
0545 remove_dupes = uicontrol(<span class="string">'Style'</span>,<span class="string">'checkbox'</span>,<span class="keyword">...</span>
0546     <span class="string">'Position'</span>,[380 360 280 20],<span class="keyword">...</span>
0547     <span class="string">'String'</span>,<span class="string">'Remove duplicates (as per full path)'</span>,<span class="keyword">...</span>
0548     <span class="string">'Value'</span>,nodupes,<span class="keyword">...</span>
0549     <span class="string">'HorizontalAlignment'</span>,<span class="string">'left'</span>,<span class="keyword">...</span>
0550     <span class="string">'KeyPressFcn'</span>,@<a href="#_sub5" class="code" title="subfunction keypressmisc(h,evt) ">keypressmisc</a>,<span class="keyword">...</span>
0551     <span class="string">'Callback'</span>,@<a href="#_sub15" class="code" title="subfunction removedupes(varargin)">removedupes</a>);
0552 recall_button = uicontrol(<span class="string">'Style'</span>,<span class="string">'pushbutton'</span>,<span class="keyword">...</span>
0553     <span class="string">'Position'</span>,[665 335 65 20],<span class="keyword">...</span>
0554     <span class="string">'String'</span>,<span class="string">'Recall'</span>,<span class="keyword">...</span>
0555     <span class="string">'KeyPressFcn'</span>,@<a href="#_sub5" class="code" title="subfunction keypressmisc(h,evt) ">keypressmisc</a>,<span class="keyword">...</span>
0556     <span class="string">'Callback'</span>,@<a href="#_sub9" class="code" title="subfunction recall(varargin)">recall</a>,<span class="keyword">...</span>
0557     <span class="string">'ToolTip'</span>,<span class="string">'Add previously selected items'</span>);
0558 label4 = uicontrol(<span class="string">'Style'</span>,<span class="string">'text'</span>,<span class="keyword">...</span>
0559     <span class="string">'Position'</span>,[380 405 350 20],<span class="keyword">...</span>
0560     <span class="string">'String'</span>,<span class="string">'Selected Items'</span>,<span class="keyword">...</span>
0561     <span class="string">'HorizontalAlignment'</span>,<span class="string">'center'</span>);
0562 done_button = uicontrol(<span class="string">'Style'</span>,<span class="string">'pushbutton'</span>,<span class="keyword">...</span>
0563     <span class="string">'Position'</span>,[280 80 80 30],<span class="keyword">...</span>
0564     <span class="string">'String'</span>,<span class="string">'Done'</span>,<span class="keyword">...</span>
0565     <span class="string">'KeyPressFcn'</span>,@<a href="#_sub5" class="code" title="subfunction keypressmisc(h,evt) ">keypressmisc</a>,<span class="keyword">...</span>
0566     <span class="string">'Callback'</span>,@<a href="#_sub23" class="code" title="subfunction done(varargin)">done</a>);
0567 cancel_button = uicontrol(<span class="string">'Style'</span>,<span class="string">'pushbutton'</span>,<span class="keyword">...</span>
0568     <span class="string">'Position'</span>,[280 30 80 30],<span class="keyword">...</span>
0569     <span class="string">'String'</span>,<span class="string">'Cancel'</span>,<span class="keyword">...</span>
0570     <span class="string">'KeyPressFcn'</span>,@<a href="#_sub5" class="code" title="subfunction keypressmisc(h,evt) ">keypressmisc</a>,<span class="keyword">...</span>
0571     <span class="string">'Callback'</span>,@<a href="#_sub24" class="code" title="subfunction cancel(varargin)">cancel</a>);
0572 
0573 <span class="comment">% If necessary, add warning about number of items to be selected.</span>
0574 num_files_warn = uicontrol(<span class="string">'Style'</span>,<span class="string">'text'</span>,<span class="keyword">...</span>
0575     <span class="string">'Position'</span>,[380 385 350 16],<span class="keyword">...</span>
0576     <span class="string">'String'</span>,numstr,<span class="keyword">...</span>
0577     <span class="string">'ForegroundColor'</span>,[0.8 0 0],<span class="keyword">...</span>
0578     <span class="string">'HorizontalAlignment'</span>,<span class="string">'center'</span>,<span class="keyword">...</span>
0579     <span class="string">'Visible'</span>,<span class="string">'off'</span>);
0580 <span class="keyword">if</span> ~isempty(prop.numfiles)
0581     set(num_files_warn,<span class="string">'Visible'</span>,<span class="string">'on'</span>)
0582 <span class="keyword">end</span>
0583 
0584 <a href="#_sub28" class="code" title="subfunction resize(varargin)">resize</a>()
0585 <span class="comment">% Make figure visible and hide handle.</span>
0586 set(fig,<span class="string">'HandleVisibility'</span>,<span class="string">'off'</span>,<span class="keyword">...</span>
0587     <span class="string">'Visible'</span>,<span class="string">'on'</span>,<span class="keyword">...</span>
0588     <span class="string">'ResizeFcn'</span>,@<a href="#_sub28" class="code" title="subfunction resize(varargin)">resize</a>)
0589 
0590 <span class="comment">% Wait until figure is closed.</span>
0591 uiwait(fig)
0592 
0593 <span class="comment">% Compute desired output.</span>
0594 <span class="keyword">switch</span> prop.output
0595     <span class="keyword">case</span> <span class="string">'cell'</span>
0596         out = full_file_picks;
0597     <span class="keyword">case</span> <span class="string">'struct'</span>
0598         out = dir_picks(:);
0599     <span class="keyword">case</span> <span class="string">'char'</span>
0600         out = char(full_file_picks);
0601     <span class="keyword">case</span> <span class="string">'cancel'</span>
0602         out = 0;
0603 <span class="keyword">end</span>
0604 
0605 <span class="comment">% Update history preference.</span>
0606 setpref(<span class="string">'uipickfiles'</span>,<span class="string">'history'</span>,history)
0607 <span class="keyword">if</span> ~isempty(full_file_picks) &amp;&amp; ~strcmp(prop.output,<span class="string">'cancel'</span>)
0608     setpref(<span class="string">'uipickfiles'</span>,<span class="string">'full_file_picks'</span>,full_file_picks)
0609 <span class="keyword">end</span>
0610 
0611 <span class="comment">% Update figure position preference.</span>
0612 setpref(<span class="string">'uipickfiles'</span>,<span class="string">'figure_position'</span>,fig_pos)
0613 
0614 
0615 <span class="comment">% ----------------- Callback nested functions ----------------</span>
0616 
0617     <a name="_sub1" href="#_subfunctions" class="code">function add(varargin)</a>
0618         values = get(navlist,<span class="string">'Value'</span>);
0619         <span class="keyword">for</span> i = 1:length(values)
0620             dir_pick = fdir(values(i));
0621             pick = dir_pick.name;
0622             pick_full = fullfile(current_dir,pick);
0623             dir_pick.name = pick_full;
0624             <span class="keyword">if</span> ~nodupes || ~any(strcmp(full_file_picks,pick_full))
0625                 file_picks{end + 1} = pick; <span class="comment">%#ok&lt;AGROW&gt;</span>
0626                 full_file_picks{end + 1} = pick_full; <span class="comment">%#ok&lt;AGROW&gt;</span>
0627                 dir_picks(end + 1) = dir_pick; <span class="comment">%#ok&lt;AGROW&gt;</span>
0628             <span class="keyword">end</span>
0629         <span class="keyword">end</span>
0630         <span class="keyword">if</span> show_full_path
0631             set(pickslist,<span class="string">'String'</span>,full_file_picks,<span class="string">'Value'</span>,[]);
0632         <span class="keyword">else</span>
0633             set(pickslist,<span class="string">'String'</span>,file_picks,<span class="string">'Value'</span>,[]);
0634         <span class="keyword">end</span>
0635         set([removebut,moveupbut,movedownbut],<span class="string">'Enable'</span>,<span class="string">'off'</span>);
0636     <span class="keyword">end</span>
0637 
0638     <a name="_sub2" href="#_subfunctions" class="code">function remove(varargin)</a>
0639         values = get(pickslist,<span class="string">'Value'</span>);
0640         file_picks(values) = [];
0641         full_file_picks(values) = [];
0642         dir_picks(values) = [];
0643         top = get(pickslist,<span class="string">'ListboxTop'</span>);
0644         num_above_top = sum(values &lt; top);
0645         top = top - num_above_top;
0646         num_picks = length(file_picks);
0647         new_value = min(min(values) - num_above_top,num_picks);
0648         <span class="keyword">if</span> num_picks == 0
0649             new_value = [];
0650             set([removebut,moveupbut,movedownbut],<span class="string">'Enable'</span>,<span class="string">'off'</span>)
0651         <span class="keyword">end</span>
0652         <span class="keyword">if</span> show_full_path
0653             set(pickslist,<span class="string">'String'</span>,full_file_picks,<span class="string">'Value'</span>,new_value,<span class="keyword">...</span>
0654                 <span class="string">'ListboxTop'</span>,top)
0655         <span class="keyword">else</span>
0656             set(pickslist,<span class="string">'String'</span>,file_picks,<span class="string">'Value'</span>,new_value,<span class="keyword">...</span>
0657                 <span class="string">'ListboxTop'</span>,top)
0658         <span class="keyword">end</span>
0659     <span class="keyword">end</span>
0660 
0661     <a name="_sub3" href="#_subfunctions" class="code">function open(varargin)</a>
0662         values = get(navlist,<span class="string">'Value'</span>);
0663         <span class="keyword">if</span> fdir(values).isdir
0664             set(fig,<span class="string">'pointer'</span>,<span class="string">'watch'</span>)
0665             drawnow
0666             <span class="comment">% Convert 'My Documents' to 'Documents' when necessary.</span>
0667             <span class="keyword">if</span> ispc &amp;&amp; strcmp(fdir(values).name,<span class="string">'My Documents'</span>)
0668                 <span class="keyword">if</span> isempty(dir(fullfile(current_dir,fdir(values).name)))
0669                     values = find(strcmp({fdir.name},<span class="string">'Documents'</span>));
0670                 <span class="keyword">end</span>
0671             <span class="keyword">end</span>
0672             current_dir = fullfile(current_dir,fdir(values).name);
0673             history = <a href="#_sub37" class="code" title="subfunction history = update_history(history,current_dir,time,history_size)">update_history</a>(history,current_dir,now,history_size);
0674             <a href="#_sub30" class="code" title="subfunction make_history_cm">make_history_cm</a>()
0675             full_filter = fullfile(current_dir,filter);
0676             path_cell = <a href="#_sub31" class="code" title="subfunction [c,network_vol] = path2cell(p)">path2cell</a>(current_dir);
0677             fdir = <a href="#_sub33" class="code" title="subfunction d = filtered_dir(full_filter,re_filter,filter_both,sort_fcn)">filtered_dir</a>(full_filter,re_filter,prop.redirs,<span class="keyword">...</span>
0678                 @(x)<a href="#_sub34" class="code" title="subfunction [files_sorted,index] = file_sort(files,sort_state)">file_sort</a>(x,sort_state));
0679             filenames = {fdir.name}';
0680             filenames = <a href="#_sub36" class="code" title="subfunction filenames = annotate_file_names(filenames,dir_listing,fsdata)">annotate_file_names</a>(filenames,fdir,fsdata);
0681             set(dir_popup,<span class="string">'String'</span>,path_cell,<span class="string">'Value'</span>,length(path_cell))
0682             <span class="keyword">if</span> length(path_cell) &gt; 1
0683                 set(up_dir_but',<span class="string">'Enable'</span>,<span class="string">'on'</span>)
0684             <span class="keyword">else</span>
0685                 set(up_dir_but',<span class="string">'Enable'</span>,<span class="string">'off'</span>)
0686             <span class="keyword">end</span>
0687             set(pathbox,<span class="string">'String'</span>,current_dir)
0688             set(navlist,<span class="string">'ListboxTop'</span>,1,<span class="string">'Value'</span>,[],<span class="string">'String'</span>,filenames)
0689             set(addbut,<span class="string">'Enable'</span>,<span class="string">'off'</span>)
0690             set(openbut,<span class="string">'Enable'</span>,<span class="string">'off'</span>)
0691             set(fig,<span class="string">'pointer'</span>,<span class="string">'arrow'</span>)
0692         <span class="keyword">end</span>
0693     <span class="keyword">end</span>
0694 
0695     <a name="_sub4" href="#_subfunctions" class="code">function clicknav(varargin)</a>
0696         value = get(navlist,<span class="string">'Value'</span>);
0697         nval = length(value);
0698         dbl_click_fcn = @<a href="#_sub1" class="code" title="subfunction add(varargin)">add</a>;
0699         <span class="keyword">switch</span> nval
0700             <span class="keyword">case</span> 0
0701                 set([addbut,openbut],<span class="string">'Enable'</span>,<span class="string">'off'</span>)
0702             <span class="keyword">case</span> 1
0703                 set(addbut,<span class="string">'Enable'</span>,<span class="string">'on'</span>);
0704                 <span class="keyword">if</span> fdir(value).isdir
0705                     set(openbut,<span class="string">'Enable'</span>,<span class="string">'on'</span>)
0706                     dbl_click_fcn = @<a href="#_sub3" class="code" title="subfunction open(varargin)">open</a>;
0707                 <span class="keyword">else</span>
0708                     set(openbut,<span class="string">'Enable'</span>,<span class="string">'off'</span>)
0709                 <span class="keyword">end</span>
0710             <span class="keyword">otherwise</span>
0711                 set(addbut,<span class="string">'Enable'</span>,<span class="string">'on'</span>)
0712                 set(openbut,<span class="string">'Enable'</span>,<span class="string">'off'</span>)
0713         <span class="keyword">end</span>
0714         <span class="keyword">if</span> strcmp(get(fig,<span class="string">'SelectionType'</span>),<span class="string">'open'</span>)
0715             dbl_click_fcn();
0716         <span class="keyword">end</span>
0717     <span class="keyword">end</span>
0718 
0719     <a name="_sub5" href="#_subfunctions" class="code">function keypressmisc(h,evt) </a><span class="comment">%#ok&lt;INUSL&gt;</span>
0720         <span class="keyword">if</span> strcmp(evt.Key,<span class="string">'escape'</span>) &amp;&amp; isequal(evt.Modifier,cell(1,0))
0721             <span class="comment">% Escape key means Cancel.</span>
0722             <a href="#_sub24" class="code" title="subfunction cancel(varargin)">cancel</a>()
0723         <span class="keyword">end</span>
0724     <span class="keyword">end</span>
0725 
0726     <a name="_sub6" href="#_subfunctions" class="code">function keypressnav(h,evt) </a><span class="comment">%#ok&lt;INUSL&gt;</span>
0727         <span class="keyword">if</span> length(path_cell) &gt; 1 &amp;&amp; strcmp(evt.Key,<span class="string">'backspace'</span>) &amp;&amp; <span class="keyword">...</span>
0728                 isequal(evt.Modifier,cell(1,0))
0729             <span class="comment">% Backspace means go to parent folder.</span>
0730             <a href="#_sub12" class="code" title="subfunction dir_up_one(varargin)">dir_up_one</a>()
0731         <span class="keyword">elseif</span> strcmp(evt.Key,<span class="string">'f'</span>) &amp;&amp; isequal(evt.Modifier,{mod_key})
0732             <span class="comment">% Control-F (Command-F on Mac) means select all files.</span>
0733             value = find(~[fdir.isdir]);
0734             set(navlist,<span class="string">'Value'</span>,value)
0735         <span class="keyword">elseif</span> strcmp(evt.Key,<span class="string">'rightarrow'</span>) &amp;&amp; <span class="keyword">...</span>
0736                 isequal(evt.Modifier,cell(1,0))
0737             <span class="comment">% Right arrow key means select the file.</span>
0738             <a href="#_sub1" class="code" title="subfunction add(varargin)">add</a>()
0739         <span class="keyword">elseif</span> strcmp(evt.Key,<span class="string">'escape'</span>) &amp;&amp; isequal(evt.Modifier,cell(1,0))
0740             <span class="comment">% Escape key means Cancel.</span>
0741             <a href="#_sub24" class="code" title="subfunction cancel(varargin)">cancel</a>()
0742         <span class="keyword">end</span>
0743     <span class="keyword">end</span>
0744 
0745     <a name="_sub7" href="#_subfunctions" class="code">function keypresslist(h,evt) </a><span class="comment">%#ok&lt;INUSL&gt;</span>
0746         <span class="keyword">if</span> strcmp(evt.Key,<span class="string">'backspace'</span>) &amp;&amp; isequal(evt.Modifier,cell(1,0))
0747             <span class="comment">% Backspace means remove item from list.</span>
0748             <a href="#_sub2" class="code" title="subfunction remove(varargin)">remove</a>()
0749         <span class="keyword">elseif</span> strcmp(evt.Key,<span class="string">'escape'</span>) &amp;&amp; isequal(evt.Modifier,cell(1,0))
0750             <span class="comment">% Escape key means Cancel.</span>
0751             <a href="#_sub24" class="code" title="subfunction cancel(varargin)">cancel</a>()
0752         <span class="keyword">end</span>
0753     <span class="keyword">end</span>
0754 
0755     <a name="_sub8" href="#_subfunctions" class="code">function clickpicks(varargin)</a>
0756         value = get(pickslist,<span class="string">'Value'</span>);
0757         <span class="keyword">if</span> isempty(value)
0758             set([removebut,moveupbut,movedownbut],<span class="string">'Enable'</span>,<span class="string">'off'</span>)
0759         <span class="keyword">else</span>
0760             set(removebut,<span class="string">'Enable'</span>,<span class="string">'on'</span>)
0761             <span class="keyword">if</span> min(value) == 1
0762                 set(moveupbut,<span class="string">'Enable'</span>,<span class="string">'off'</span>)
0763             <span class="keyword">else</span>
0764                 set(moveupbut,<span class="string">'Enable'</span>,<span class="string">'on'</span>)
0765             <span class="keyword">end</span>
0766             <span class="keyword">if</span> max(value) == length(file_picks)
0767                 set(movedownbut,<span class="string">'Enable'</span>,<span class="string">'off'</span>)
0768             <span class="keyword">else</span>
0769                 set(movedownbut,<span class="string">'Enable'</span>,<span class="string">'on'</span>)
0770             <span class="keyword">end</span>
0771         <span class="keyword">end</span>
0772         <span class="keyword">if</span> strcmp(get(fig,<span class="string">'SelectionType'</span>),<span class="string">'open'</span>)
0773             <a href="#_sub2" class="code" title="subfunction remove(varargin)">remove</a>();
0774         <span class="keyword">end</span>
0775     <span class="keyword">end</span>
0776 
0777     <a name="_sub9" href="#_subfunctions" class="code">function recall(varargin)</a>
0778         <span class="keyword">if</span> ispref(<span class="string">'uipickfiles'</span>,<span class="string">'full_file_picks'</span>)
0779             ffp = getpref(<span class="string">'uipickfiles'</span>,<span class="string">'full_file_picks'</span>);
0780         <span class="keyword">else</span>
0781             ffp = {};
0782         <span class="keyword">end</span>
0783         <span class="keyword">for</span> i = 1:length(ffp)
0784             <span class="keyword">if</span> exist(ffp{i},<span class="string">'dir'</span>) &amp;&amp; <span class="keyword">...</span>
0785                     (~nodupes || ~any(strcmp(full_file_picks,ffp{i})))
0786                 full_file_picks{end + 1} = ffp{i}; <span class="comment">%#ok&lt;AGROW&gt;</span>
0787                 [unused,fn,ext] = fileparts(ffp{i});
0788                 file_picks{end + 1} = [fn,ext]; <span class="comment">%#ok&lt;AGROW&gt;</span>
0789                 temp = dir(fullfile(ffp{i},<span class="string">'..'</span>));
0790                 <span class="keyword">if</span> ispc || ismac
0791                     thisdir = strcmpi({temp.name},[fn,ext]);
0792                 <span class="keyword">else</span>
0793                     thisdir = strcmp({temp.name},[fn,ext]);
0794                 <span class="keyword">end</span>
0795                 dir_picks(end + 1) = temp(thisdir); <span class="comment">%#ok&lt;AGROW&gt;</span>
0796                 dir_picks(end).name = ffp{i};
0797             <span class="keyword">elseif</span> exist(ffp{i},<span class="string">'file'</span>) &amp;&amp; <span class="keyword">...</span>
0798                     (~nodupes || ~any(strcmp(full_file_picks,ffp{i})))
0799                 full_file_picks{end + 1} = ffp{i}; <span class="comment">%#ok&lt;AGROW&gt;</span>
0800                 [unused,fn,ext] = fileparts(ffp{i});
0801                 file_picks{end + 1} = [fn,ext]; <span class="comment">%#ok&lt;AGROW&gt;</span>
0802                 dir_picks(end + 1) = dir(ffp{i}); <span class="comment">%#ok&lt;AGROW&gt;</span>
0803                 dir_picks(end).name = ffp{i};
0804             <span class="keyword">end</span>
0805         <span class="keyword">end</span>
0806         <span class="keyword">if</span> show_full_path
0807             set(pickslist,<span class="string">'String'</span>,full_file_picks,<span class="string">'Value'</span>,[]);
0808         <span class="keyword">else</span>
0809             set(pickslist,<span class="string">'String'</span>,file_picks,<span class="string">'Value'</span>,[]);
0810         <span class="keyword">end</span>
0811         set([removebut,moveupbut,movedownbut],<span class="string">'Enable'</span>,<span class="string">'off'</span>);
0812     <span class="keyword">end</span>
0813 
0814     <a name="_sub10" href="#_subfunctions" class="code">function sort_type(h,evt,cb) </a><span class="comment">%#ok&lt;INUSL&gt;</span>
0815         <span class="keyword">if</span> sort_state(cb)
0816             sort_state(cb) = -sort_state(cb);
0817             last_sort_state(cb) = sort_state(cb);
0818         <span class="keyword">else</span>
0819             sort_state = zeros(1,3);
0820             sort_state(cb) = last_sort_state(cb);
0821         <span class="keyword">end</span>
0822         set(sort_cb,{<span class="string">'CData'</span>},tri_icon(sort_state + 2)')
0823         
0824         fdir = <a href="#_sub33" class="code" title="subfunction d = filtered_dir(full_filter,re_filter,filter_both,sort_fcn)">filtered_dir</a>(full_filter,re_filter,prop.redirs,<span class="keyword">...</span>
0825                 @(x)<a href="#_sub34" class="code" title="subfunction [files_sorted,index] = file_sort(files,sort_state)">file_sort</a>(x,sort_state));
0826         filenames = {fdir.name}';
0827         filenames = <a href="#_sub36" class="code" title="subfunction filenames = annotate_file_names(filenames,dir_listing,fsdata)">annotate_file_names</a>(filenames,fdir,fsdata);
0828         set(dir_popup,<span class="string">'String'</span>,path_cell,<span class="string">'Value'</span>,length(path_cell))
0829         <span class="keyword">if</span> length(path_cell) &gt; 1
0830             set(up_dir_but',<span class="string">'Enable'</span>,<span class="string">'on'</span>)
0831         <span class="keyword">else</span>
0832             set(up_dir_but',<span class="string">'Enable'</span>,<span class="string">'off'</span>)
0833         <span class="keyword">end</span>
0834         set(pathbox,<span class="string">'String'</span>,current_dir)
0835         set(navlist,<span class="string">'String'</span>,filenames,<span class="string">'Value'</span>,[])
0836         set(addbut,<span class="string">'Enable'</span>,<span class="string">'off'</span>)
0837         set(openbut,<span class="string">'Enable'</span>,<span class="string">'off'</span>)
0838         set(fig,<span class="string">'pointer'</span>,<span class="string">'arrow'</span>)
0839     <span class="keyword">end</span>
0840 
0841     <a name="_sub11" href="#_subfunctions" class="code">function dirpopup(varargin)</a>
0842         value = get(dir_popup,<span class="string">'Value'</span>);
0843         container = path_cell{min(value + 1,length(path_cell))};
0844         path_cell = path_cell(1:value);
0845         set(fig,<span class="string">'pointer'</span>,<span class="string">'watch'</span>)
0846         drawnow
0847         <span class="keyword">if</span> ispc &amp;&amp; value == 1
0848             current_dir = <span class="string">''</span>;
0849             full_filter = filter;
0850             drives = <a href="#_sub35" class="code" title="subfunction drives = getdrives(other_drives)">getdrives</a>(network_volumes);
0851             num_drives = length(drives);
0852             temp = tempname;
0853             mkdir(temp)
0854             dir_temp = dir(temp);
0855             rmdir(temp)
0856             fdir = repmat(dir_temp(1),num_drives,1);
0857             [fdir.name] = deal(drives{:});
0858         <span class="keyword">else</span>
0859             current_dir = <a href="#_sub32" class="code" title="subfunction p = cell2path(c)">cell2path</a>(path_cell);
0860             history = <a href="#_sub37" class="code" title="subfunction history = update_history(history,current_dir,time,history_size)">update_history</a>(history,current_dir,now,history_size);
0861             <a href="#_sub30" class="code" title="subfunction make_history_cm">make_history_cm</a>()
0862             full_filter = fullfile(current_dir,filter);
0863             fdir = <a href="#_sub33" class="code" title="subfunction d = filtered_dir(full_filter,re_filter,filter_both,sort_fcn)">filtered_dir</a>(full_filter,re_filter,prop.redirs,<span class="keyword">...</span>
0864                 @(x)<a href="#_sub34" class="code" title="subfunction [files_sorted,index] = file_sort(files,sort_state)">file_sort</a>(x,sort_state));
0865         <span class="keyword">end</span>
0866         filenames = {fdir.name}';
0867         selected = find(strcmp(filenames,container));
0868         filenames = <a href="#_sub36" class="code" title="subfunction filenames = annotate_file_names(filenames,dir_listing,fsdata)">annotate_file_names</a>(filenames,fdir,fsdata);
0869         set(dir_popup,<span class="string">'String'</span>,path_cell,<span class="string">'Value'</span>,length(path_cell))
0870         <span class="keyword">if</span> length(path_cell) &gt; 1
0871             set(up_dir_but',<span class="string">'Enable'</span>,<span class="string">'on'</span>)
0872         <span class="keyword">else</span>
0873             set(up_dir_but',<span class="string">'Enable'</span>,<span class="string">'off'</span>)
0874         <span class="keyword">end</span>
0875         set(pathbox,<span class="string">'String'</span>,current_dir)
0876         set(navlist,<span class="string">'String'</span>,filenames,<span class="string">'Value'</span>,selected)
0877         set(addbut,<span class="string">'Enable'</span>,<span class="string">'off'</span>)
0878         set(fig,<span class="string">'pointer'</span>,<span class="string">'arrow'</span>)
0879     <span class="keyword">end</span>
0880 
0881     <a name="_sub12" href="#_subfunctions" class="code">function dir_up_one(varargin)</a>
0882         value = length(path_cell) - 1;
0883         container = path_cell{value + 1};
0884         path_cell = path_cell(1:value);
0885         set(fig,<span class="string">'pointer'</span>,<span class="string">'watch'</span>)
0886         drawnow
0887         <span class="keyword">if</span> ispc &amp;&amp; value == 1
0888             current_dir = <span class="string">''</span>;
0889             full_filter = filter;
0890             drives = <a href="#_sub35" class="code" title="subfunction drives = getdrives(other_drives)">getdrives</a>(network_volumes);
0891             num_drives = length(drives);
0892             temp = tempname;
0893             mkdir(temp)
0894             dir_temp = dir(temp);
0895             rmdir(temp)
0896             fdir = repmat(dir_temp(1),num_drives,1);
0897             [fdir.name] = deal(drives{:});
0898         <span class="keyword">else</span>
0899             current_dir = <a href="#_sub32" class="code" title="subfunction p = cell2path(c)">cell2path</a>(path_cell);
0900             history = <a href="#_sub37" class="code" title="subfunction history = update_history(history,current_dir,time,history_size)">update_history</a>(history,current_dir,now,history_size);
0901             <a href="#_sub30" class="code" title="subfunction make_history_cm">make_history_cm</a>()
0902             full_filter = fullfile(current_dir,filter);
0903             fdir = <a href="#_sub33" class="code" title="subfunction d = filtered_dir(full_filter,re_filter,filter_both,sort_fcn)">filtered_dir</a>(full_filter,re_filter,prop.redirs,<span class="keyword">...</span>
0904                 @(x)<a href="#_sub34" class="code" title="subfunction [files_sorted,index] = file_sort(files,sort_state)">file_sort</a>(x,sort_state));
0905         <span class="keyword">end</span>
0906         filenames = {fdir.name}';
0907         selected = find(strcmp(filenames,container));
0908         filenames = <a href="#_sub36" class="code" title="subfunction filenames = annotate_file_names(filenames,dir_listing,fsdata)">annotate_file_names</a>(filenames,fdir,fsdata);
0909         set(dir_popup,<span class="string">'String'</span>,path_cell,<span class="string">'Value'</span>,length(path_cell))
0910         <span class="keyword">if</span> length(path_cell) &gt; 1
0911             set(up_dir_but',<span class="string">'Enable'</span>,<span class="string">'on'</span>)
0912         <span class="keyword">else</span>
0913             set(up_dir_but',<span class="string">'Enable'</span>,<span class="string">'off'</span>)
0914         <span class="keyword">end</span>
0915         set(pathbox,<span class="string">'String'</span>,current_dir)
0916         set(navlist,<span class="string">'String'</span>,filenames,<span class="string">'Value'</span>,selected)
0917         set(addbut,<span class="string">'Enable'</span>,<span class="string">'off'</span>)
0918         set(fig,<span class="string">'pointer'</span>,<span class="string">'arrow'</span>)
0919     <span class="keyword">end</span>
0920 
0921     <a name="_sub13" href="#_subfunctions" class="code">function change_path(varargin)</a>
0922         set(fig,<span class="string">'pointer'</span>,<span class="string">'watch'</span>)
0923         drawnow
0924         proposed_path = get(pathbox,<span class="string">'String'</span>);
0925         <span class="comment">% Process any folders named '..'.</span>
0926         proposed_path_cell = <a href="#_sub31" class="code" title="subfunction [c,network_vol] = path2cell(p)">path2cell</a>(proposed_path);
0927         ddots = strcmp(proposed_path_cell,<span class="string">'..'</span>);
0928         ddots(find(ddots) - 1) = true;
0929         proposed_path_cell(ddots) = [];
0930         proposed_path = <a href="#_sub32" class="code" title="subfunction p = cell2path(c)">cell2path</a>(proposed_path_cell);
0931         <span class="comment">% Check for existance of folder.</span>
0932         <span class="keyword">if</span> ~exist(proposed_path,<span class="string">'dir'</span>)
0933             set(fig,<span class="string">'pointer'</span>,<span class="string">'arrow'</span>)
0934             uiwait(errordlg([<span class="string">'Folder &quot;'</span>,proposed_path,<span class="keyword">...</span>
0935                 <span class="string">'&quot; does not exist.'</span>],<span class="string">''</span>,<span class="string">'modal'</span>))
0936             <span class="keyword">return</span>
0937         <span class="keyword">end</span>
0938         current_dir = proposed_path;
0939         history = <a href="#_sub37" class="code" title="subfunction history = update_history(history,current_dir,time,history_size)">update_history</a>(history,current_dir,now,history_size);
0940         <a href="#_sub30" class="code" title="subfunction make_history_cm">make_history_cm</a>()
0941         full_filter = fullfile(current_dir,filter);
0942         [path_cell,new_network_vol] = <a href="#_sub31" class="code" title="subfunction [c,network_vol] = path2cell(p)">path2cell</a>(current_dir);
0943         <span class="keyword">if</span> exist(new_network_vol,<span class="string">'dir'</span>)
0944             network_volumes = unique([network_volumes,{new_network_vol}]);
0945         <span class="keyword">end</span>
0946         fdir = <a href="#_sub33" class="code" title="subfunction d = filtered_dir(full_filter,re_filter,filter_both,sort_fcn)">filtered_dir</a>(full_filter,re_filter,prop.redirs,<span class="keyword">...</span>
0947                 @(x)<a href="#_sub34" class="code" title="subfunction [files_sorted,index] = file_sort(files,sort_state)">file_sort</a>(x,sort_state));
0948         filenames = {fdir.name}';
0949         filenames = <a href="#_sub36" class="code" title="subfunction filenames = annotate_file_names(filenames,dir_listing,fsdata)">annotate_file_names</a>(filenames,fdir,fsdata);
0950         set(dir_popup,<span class="string">'String'</span>,path_cell,<span class="string">'Value'</span>,length(path_cell))
0951         <span class="keyword">if</span> length(path_cell) &gt; 1
0952             set(up_dir_but',<span class="string">'Enable'</span>,<span class="string">'on'</span>)
0953         <span class="keyword">else</span>
0954             set(up_dir_but',<span class="string">'Enable'</span>,<span class="string">'off'</span>)
0955         <span class="keyword">end</span>
0956         set(pathbox,<span class="string">'String'</span>,current_dir)
0957         set(navlist,<span class="string">'String'</span>,filenames,<span class="string">'Value'</span>,[])
0958         set(addbut,<span class="string">'Enable'</span>,<span class="string">'off'</span>)
0959         set(openbut,<span class="string">'Enable'</span>,<span class="string">'off'</span>)
0960         set(fig,<span class="string">'pointer'</span>,<span class="string">'arrow'</span>)
0961     <span class="keyword">end</span>
0962 
0963     <a name="_sub14" href="#_subfunctions" class="code">function showfullpath(varargin)</a>
0964         show_full_path = get(viewfullpath,<span class="string">'Value'</span>);
0965         <span class="keyword">if</span> show_full_path
0966             set(pickslist,<span class="string">'String'</span>,full_file_picks)
0967         <span class="keyword">else</span>
0968             set(pickslist,<span class="string">'String'</span>,file_picks)
0969         <span class="keyword">end</span>
0970     <span class="keyword">end</span>
0971 
0972     <a name="_sub15" href="#_subfunctions" class="code">function removedupes(varargin)</a>
0973         nodupes = get(remove_dupes,<span class="string">'Value'</span>);
0974         <span class="keyword">if</span> nodupes
0975             num_picks = length(full_file_picks);
0976             [unused,rev_order] = unique(full_file_picks(end:-1:1)); <span class="comment">%#ok&lt;SETNU&gt;</span>
0977             order = sort(num_picks + 1 - rev_order);
0978             full_file_picks = full_file_picks(order);
0979             file_picks = file_picks(order);
0980             dir_picks = dir_picks(order);
0981             <span class="keyword">if</span> show_full_path
0982                 set(pickslist,<span class="string">'String'</span>,full_file_picks,<span class="string">'Value'</span>,[])
0983             <span class="keyword">else</span>
0984                 set(pickslist,<span class="string">'String'</span>,file_picks,<span class="string">'Value'</span>,[])
0985             <span class="keyword">end</span>
0986             set([removebut,moveupbut,movedownbut],<span class="string">'Enable'</span>,<span class="string">'off'</span>)
0987         <span class="keyword">end</span>
0988     <span class="keyword">end</span>
0989 
0990     <a name="_sub16" href="#_subfunctions" class="code">function moveup(varargin)</a>
0991         value = get(pickslist,<span class="string">'Value'</span>);
0992         set(removebut,<span class="string">'Enable'</span>,<span class="string">'on'</span>)
0993         n = length(file_picks);
0994         omega = 1:n;
0995         index = zeros(1,n);
0996         index(value - 1) = omega(value);
0997         index(setdiff(omega,value - 1)) = omega(setdiff(omega,value));
0998         file_picks = file_picks(index);
0999         full_file_picks = full_file_picks(index);
1000         dir_picks = dir_picks(index);
1001         value = value - 1;
1002         <span class="keyword">if</span> show_full_path
1003             set(pickslist,<span class="string">'String'</span>,full_file_picks,<span class="string">'Value'</span>,value)
1004         <span class="keyword">else</span>
1005             set(pickslist,<span class="string">'String'</span>,file_picks,<span class="string">'Value'</span>,value)
1006         <span class="keyword">end</span>
1007         <span class="keyword">if</span> min(value) == 1
1008             set(moveupbut,<span class="string">'Enable'</span>,<span class="string">'off'</span>)
1009         <span class="keyword">end</span>
1010         set(movedownbut,<span class="string">'Enable'</span>,<span class="string">'on'</span>)
1011     <span class="keyword">end</span>
1012 
1013     <a name="_sub17" href="#_subfunctions" class="code">function movedown(varargin)</a>
1014         value = get(pickslist,<span class="string">'Value'</span>);
1015         set(removebut,<span class="string">'Enable'</span>,<span class="string">'on'</span>)
1016         n = length(file_picks);
1017         omega = 1:n;
1018         index = zeros(1,n);
1019         index(value + 1) = omega(value);
1020         index(setdiff(omega,value + 1)) = omega(setdiff(omega,value));
1021         file_picks = file_picks(index);
1022         full_file_picks = full_file_picks(index);
1023         dir_picks = dir_picks(index);
1024         value = value + 1;
1025         <span class="keyword">if</span> show_full_path
1026             set(pickslist,<span class="string">'String'</span>,full_file_picks,<span class="string">'Value'</span>,value)
1027         <span class="keyword">else</span>
1028             set(pickslist,<span class="string">'String'</span>,file_picks,<span class="string">'Value'</span>,value)
1029         <span class="keyword">end</span>
1030         <span class="keyword">if</span> max(value) == n
1031             set(movedownbut,<span class="string">'Enable'</span>,<span class="string">'off'</span>)
1032         <span class="keyword">end</span>
1033         set(moveupbut,<span class="string">'Enable'</span>,<span class="string">'on'</span>)
1034     <span class="keyword">end</span>
1035 
1036     <a name="_sub18" href="#_subfunctions" class="code">function togglefilter(varargin)</a>
1037         set(fig,<span class="string">'pointer'</span>,<span class="string">'watch'</span>)
1038         drawnow
1039         value = get(showallfiles,<span class="string">'Value'</span>);
1040         <span class="keyword">if</span> value
1041             filter = <span class="string">'*'</span>;
1042             re_filter = <span class="string">''</span>;
1043             set([filter_ed,refilter_ed],<span class="string">'Enable'</span>,<span class="string">'off'</span>)
1044         <span class="keyword">else</span>
1045             filter = get(filter_ed,<span class="string">'String'</span>);
1046             re_filter = get(refilter_ed,<span class="string">'String'</span>);
1047             set([filter_ed,refilter_ed],<span class="string">'Enable'</span>,<span class="string">'on'</span>)
1048         <span class="keyword">end</span>
1049         full_filter = fullfile(current_dir,filter);
1050         fdir = <a href="#_sub33" class="code" title="subfunction d = filtered_dir(full_filter,re_filter,filter_both,sort_fcn)">filtered_dir</a>(full_filter,re_filter,prop.redirs,<span class="keyword">...</span>
1051                 @(x)<a href="#_sub34" class="code" title="subfunction [files_sorted,index] = file_sort(files,sort_state)">file_sort</a>(x,sort_state));
1052         filenames = {fdir.name}';
1053         filenames = <a href="#_sub36" class="code" title="subfunction filenames = annotate_file_names(filenames,dir_listing,fsdata)">annotate_file_names</a>(filenames,fdir,fsdata);
1054         set(navlist,<span class="string">'String'</span>,filenames,<span class="string">'Value'</span>,[])
1055         set(addbut,<span class="string">'Enable'</span>,<span class="string">'off'</span>)
1056         set(fig,<span class="string">'pointer'</span>,<span class="string">'arrow'</span>)
1057     <span class="keyword">end</span>
1058 
1059     <a name="_sub19" href="#_subfunctions" class="code">function toggle_refiltdirs(varargin)</a>
1060         set(fig,<span class="string">'pointer'</span>,<span class="string">'watch'</span>)
1061         drawnow
1062         value = get(refilterdirs,<span class="string">'Value'</span>);
1063         prop.redirs = value;
1064         full_filter = fullfile(current_dir,filter);
1065         fdir = <a href="#_sub33" class="code" title="subfunction d = filtered_dir(full_filter,re_filter,filter_both,sort_fcn)">filtered_dir</a>(full_filter,re_filter,prop.redirs,<span class="keyword">...</span>
1066                 @(x)<a href="#_sub34" class="code" title="subfunction [files_sorted,index] = file_sort(files,sort_state)">file_sort</a>(x,sort_state));
1067         filenames = {fdir.name}';
1068         filenames = <a href="#_sub36" class="code" title="subfunction filenames = annotate_file_names(filenames,dir_listing,fsdata)">annotate_file_names</a>(filenames,fdir,fsdata);
1069         set(navlist,<span class="string">'String'</span>,filenames,<span class="string">'Value'</span>,[])
1070         set(addbut,<span class="string">'Enable'</span>,<span class="string">'off'</span>)
1071         set(fig,<span class="string">'pointer'</span>,<span class="string">'arrow'</span>)
1072     <span class="keyword">end</span>
1073 
1074     <a name="_sub20" href="#_subfunctions" class="code">function setfilspec(varargin)</a>
1075         set(fig,<span class="string">'pointer'</span>,<span class="string">'watch'</span>)
1076         drawnow
1077         filter = get(filter_ed,<span class="string">'String'</span>);
1078         <span class="keyword">if</span> isempty(filter)
1079             filter = <span class="string">'*'</span>;
1080             set(filter_ed,<span class="string">'String'</span>,filter)
1081         <span class="keyword">end</span>
1082         <span class="comment">% Process file spec if a subdirectory was included.</span>
1083         [p,f,e] = fileparts(filter);
1084         <span class="keyword">if</span> ~isempty(p)
1085             newpath = fullfile(current_dir,p,<span class="string">''</span>);
1086             set(pathbox,<span class="string">'String'</span>,newpath)
1087             filter = [f,e];
1088             <span class="keyword">if</span> isempty(filter)
1089                 filter = <span class="string">'*'</span>;
1090             <span class="keyword">end</span>
1091             set(filter_ed,<span class="string">'String'</span>,filter)
1092             <a href="#_sub13" class="code" title="subfunction change_path(varargin)">change_path</a>();
1093         <span class="keyword">end</span>
1094         full_filter = fullfile(current_dir,filter);
1095         fdir = <a href="#_sub33" class="code" title="subfunction d = filtered_dir(full_filter,re_filter,filter_both,sort_fcn)">filtered_dir</a>(full_filter,re_filter,prop.redirs,<span class="keyword">...</span>
1096                 @(x)<a href="#_sub34" class="code" title="subfunction [files_sorted,index] = file_sort(files,sort_state)">file_sort</a>(x,sort_state));
1097         filenames = {fdir.name}';
1098         filenames = <a href="#_sub36" class="code" title="subfunction filenames = annotate_file_names(filenames,dir_listing,fsdata)">annotate_file_names</a>(filenames,fdir,fsdata);
1099         set(navlist,<span class="string">'String'</span>,filenames,<span class="string">'Value'</span>,[])
1100         set(addbut,<span class="string">'Enable'</span>,<span class="string">'off'</span>)
1101         set(fig,<span class="string">'pointer'</span>,<span class="string">'arrow'</span>)
1102     <span class="keyword">end</span>
1103 
1104     <a name="_sub21" href="#_subfunctions" class="code">function setrefilter(varargin)</a>
1105         set(fig,<span class="string">'pointer'</span>,<span class="string">'watch'</span>)
1106         drawnow
1107         re_filter = get(refilter_ed,<span class="string">'String'</span>);
1108         fdir = <a href="#_sub33" class="code" title="subfunction d = filtered_dir(full_filter,re_filter,filter_both,sort_fcn)">filtered_dir</a>(full_filter,re_filter,prop.redirs,<span class="keyword">...</span>
1109                 @(x)<a href="#_sub34" class="code" title="subfunction [files_sorted,index] = file_sort(files,sort_state)">file_sort</a>(x,sort_state));
1110         filenames = {fdir.name}';
1111         filenames = <a href="#_sub36" class="code" title="subfunction filenames = annotate_file_names(filenames,dir_listing,fsdata)">annotate_file_names</a>(filenames,fdir,fsdata);
1112         set(navlist,<span class="string">'String'</span>,filenames,<span class="string">'Value'</span>,[])
1113         set(addbut,<span class="string">'Enable'</span>,<span class="string">'off'</span>)
1114         set(fig,<span class="string">'pointer'</span>,<span class="string">'arrow'</span>)
1115     <span class="keyword">end</span>
1116 
1117     <a name="_sub22" href="#_subfunctions" class="code">function filter_type_callback(varargin)</a>
1118         type_value = get(type_popup,<span class="string">'Value'</span>);
1119         set(filter_ed,<span class="string">'String'</span>,prop.type{type_value,1})
1120         <a href="#_sub20" class="code" title="subfunction setfilspec(varargin)">setfilspec</a>()
1121     <span class="keyword">end</span>
1122 
1123     <a name="_sub23" href="#_subfunctions" class="code">function done(varargin)</a>
1124         <span class="comment">% Optional shortcut: click on a file and press 'Done'.</span>
1125 <span class="comment">%         if isempty(full_file_picks) &amp;&amp; strcmp(get(addbut,'Enable'),'on')</span>
1126 <span class="comment">%             add();</span>
1127 <span class="comment">%         end</span>
1128         numfiles = length(full_file_picks);
1129         <span class="keyword">if</span> ~isempty(prop.numfiles)
1130             <span class="keyword">if</span> numfiles &lt; prop.numfiles(1)
1131                 msg = {<span class="string">'Too few items selected.'</span>,numstr};
1132                 uiwait(errordlg(msg,<span class="string">''</span>,<span class="string">'modal'</span>))
1133                 <span class="keyword">return</span>
1134             <span class="keyword">elseif</span> numfiles &gt; prop.numfiles(end)
1135                 msg = {<span class="string">'Too many items selected.'</span>,numstr};
1136                 uiwait(errordlg(msg,<span class="string">''</span>,<span class="string">'modal'</span>))
1137                 <span class="keyword">return</span>
1138             <span class="keyword">end</span>
1139         <span class="keyword">end</span>
1140         fig_pos = get(fig,<span class="string">'Position'</span>);
1141         delete(fig)
1142     <span class="keyword">end</span>
1143 
1144     <a name="_sub24" href="#_subfunctions" class="code">function cancel(varargin)</a>
1145         prop.output = <span class="string">'cancel'</span>;
1146         fig_pos = get(fig,<span class="string">'Position'</span>);
1147         delete(fig)
1148     <span class="keyword">end</span>
1149 
1150     <a name="_sub25" href="#_subfunctions" class="code">function history_cb(varargin)</a>
1151         set(fig,<span class="string">'pointer'</span>,<span class="string">'watch'</span>)
1152         drawnow
1153         current_dir = history(varargin{3}).name;
1154         history = <a href="#_sub37" class="code" title="subfunction history = update_history(history,current_dir,time,history_size)">update_history</a>(history,current_dir,now,history_size);
1155         <a href="#_sub30" class="code" title="subfunction make_history_cm">make_history_cm</a>()
1156         full_filter = fullfile(current_dir,filter);
1157         path_cell = <a href="#_sub31" class="code" title="subfunction [c,network_vol] = path2cell(p)">path2cell</a>(current_dir);
1158         fdir = <a href="#_sub33" class="code" title="subfunction d = filtered_dir(full_filter,re_filter,filter_both,sort_fcn)">filtered_dir</a>(full_filter,re_filter,prop.redirs,<span class="keyword">...</span>
1159                 @(x)<a href="#_sub34" class="code" title="subfunction [files_sorted,index] = file_sort(files,sort_state)">file_sort</a>(x,sort_state));
1160         filenames = {fdir.name}';
1161         filenames = <a href="#_sub36" class="code" title="subfunction filenames = annotate_file_names(filenames,dir_listing,fsdata)">annotate_file_names</a>(filenames,fdir,fsdata);
1162         set(dir_popup,<span class="string">'String'</span>,path_cell,<span class="string">'Value'</span>,length(path_cell))
1163         <span class="keyword">if</span> length(path_cell) &gt; 1
1164             set(up_dir_but',<span class="string">'Enable'</span>,<span class="string">'on'</span>)
1165         <span class="keyword">else</span>
1166             set(up_dir_but',<span class="string">'Enable'</span>,<span class="string">'off'</span>)
1167         <span class="keyword">end</span>
1168         set(pathbox,<span class="string">'String'</span>,current_dir)
1169         set(navlist,<span class="string">'ListboxTop'</span>,1,<span class="string">'Value'</span>,[],<span class="string">'String'</span>,filenames)
1170         set(addbut,<span class="string">'Enable'</span>,<span class="string">'off'</span>)
1171         set(openbut,<span class="string">'Enable'</span>,<span class="string">'off'</span>)
1172         set(fig,<span class="string">'pointer'</span>,<span class="string">'arrow'</span>)
1173     <span class="keyword">end</span>
1174 
1175     <a name="_sub26" href="#_subfunctions" class="code">function clear_history(varargin)</a>
1176         history = <a href="#_sub37" class="code" title="subfunction history = update_history(history,current_dir,time,history_size)">update_history</a>(history(1),<span class="string">''</span>,[],history_size);
1177         <a href="#_sub30" class="code" title="subfunction make_history_cm">make_history_cm</a>()
1178     <span class="keyword">end</span>
1179 
1180     <a name="_sub27" href="#_subfunctions" class="code">function set_history_size(varargin)</a>
1181         result_cell = inputdlg(<span class="string">'Number of Recent Folders:'</span>,<span class="string">''</span>,1,<span class="keyword">...</span>
1182             {sprintf(<span class="string">'%g'</span>,history_size)});
1183         <span class="keyword">if</span> isempty(result_cell)
1184             <span class="keyword">return</span>
1185         <span class="keyword">end</span>
1186         result = sscanf(result_cell{1},<span class="string">'%f'</span>);
1187         <span class="keyword">if</span> isempty(result) || result &lt; 1
1188             <span class="keyword">return</span>
1189         <span class="keyword">end</span>
1190         history_size = result;
1191         history = <a href="#_sub37" class="code" title="subfunction history = update_history(history,current_dir,time,history_size)">update_history</a>(history,<span class="string">''</span>,[],history_size);
1192         <a href="#_sub30" class="code" title="subfunction make_history_cm">make_history_cm</a>()
1193         setpref(<span class="string">'uipickfiles'</span>,<span class="string">'history_size'</span>,history_size)
1194     <span class="keyword">end</span>
1195 
1196     <a name="_sub28" href="#_subfunctions" class="code">function resize(varargin)</a>
1197         <span class="comment">% Get current figure size.</span>
1198         P = <span class="string">'Position'</span>;
1199         pos = get(fig,P);
1200         w = pos(3); <span class="comment">% figure width in pixels</span>
1201         h = pos(4); <span class="comment">% figure height in pixels</span>
1202         
1203         <span class="comment">% Enforce minimum figure size.</span>
1204         w = max(w,564);
1205         h = max(h,443);
1206         <span class="keyword">if</span> any(pos(3:4) &lt; [w h])
1207             pos(3:4) = [w h];
1208             set(fig,P,pos)
1209         <span class="keyword">end</span>
1210         
1211         <span class="comment">% Change positions of all uicontrols based on the current figure</span>
1212         <span class="comment">% width and height.</span>
1213         navw_pckw = round([1 1;-350 250]\[w-140;0]);
1214         navw = navw_pckw(1);
1215         pckw = navw_pckw(2);
1216         navp = [10 10 navw h-174];
1217         pckp = [w-10-pckw 10 pckw h-174];
1218         set(navlist,P,navp)
1219         set(pickslist,P,pckp)
1220         
1221         set(frame1,P,[navw+5 h-234 110 70])
1222         set(openbut,P,[navw+20 h-194 80 20])
1223         set(addbut,P,[navw+20 h-224 80 20])
1224         
1225         frame2y = round((h-234 + 110 - 100)/2);
1226         set(frame2,P,[w-pckw-115 frame2y 110 100])
1227         set(removebut,P,[w-pckw-100 frame2y+70 80 20])
1228         set(moveupbut,P,[w-pckw-100 frame2y+40 80 20])
1229         set(movedownbut,P,[w-pckw-100 frame2y+10 80 20])
1230         
1231         set(done_button,P,[navw+30 80 80 30])
1232         set(cancel_button,P,[navw+30 30 80 30])
1233         
1234         set(sort_cb(1),P,[15 h-163 70 15])
1235         set(sort_cb(2),P,[85 h-163 70 15])
1236         set(sort_cb(3),P,[155 h-163 70 15])
1237         
1238         set(dir_popup,P,[10 h-144 navw-25 20])
1239         set(up_dir_but,P,[navw-10 h-144 20 20])
1240         set(pathbox,P,[10 h-119 navw 26])
1241         set(label1,P,[10 h-93 navw 16])
1242         
1243         set(viewfullpath,P,[pckp(1) h-159 230 20])
1244         set(remove_dupes,P,[pckp(1) h-134 280 20])
1245         set(recall_button,P,[w-75 h-159 65 20])
1246         set(label4,P,[w-10-pckw h-89 pckw 20])
1247         set(num_files_warn,P,[w-10-pckw h-109 pckw 16])
1248         
1249         set(label2,P,[10 h-18 80 17])
1250         set(label3,P,[100 h-18 160 17])
1251         set(showallfiles,P,[270 h-42 110 20])
1252         set(refilterdirs,P,[270 h-64 100 20])
1253         set(filter_ed,P,[10 h-44 80 26])
1254         set(refilter_ed,P,[100 h-44 160 26])
1255         set(type_popup,P,[10 h-72 250 20])
1256     <span class="keyword">end</span>
1257 
1258     <a name="_sub29" href="#_subfunctions" class="code">function reset_figure_size(varargin)</a>
1259         <span class="keyword">if</span> strcmp(get(fig,<span class="string">'SelectionType'</span>),<span class="string">'open'</span>)
1260             root_units = get(0,<span class="string">'units'</span>);
1261             screen_size = get(0,<span class="string">'ScreenSize'</span>);
1262             set(0,<span class="string">'Units'</span>,root_units)
1263             hw = [740 494];
1264             pos = [round((screen_size(3:4) - hw - [0 26])/2),hw];
1265             set(fig,<span class="string">'Position'</span>,pos)
1266             <a href="#_sub28" class="code" title="subfunction resize(varargin)">resize</a>()
1267         <span class="keyword">end</span>
1268     <span class="keyword">end</span>
1269 
1270 
1271 
1272 <span class="comment">% ------------------ Other nested functions ------------------</span>
1273 
1274     <a name="_sub30" href="#_subfunctions" class="code">function make_history_cm</a>
1275         <span class="comment">% Make context menu for history.</span>
1276         <span class="keyword">if</span> ~isempty(hist_menus)
1277             delete(hist_menus)
1278         <span class="keyword">end</span>
1279         num_hist = length(history);
1280         hist_menus = zeros(1,num_hist+2);
1281         <span class="keyword">for</span> i = 1:num_hist
1282             hist_menus(i) = uimenu(hist_cm,<span class="string">'Label'</span>,history(i).name,<span class="keyword">...</span>
1283                 <span class="string">'Callback'</span>,{@<a href="#_sub25" class="code" title="subfunction history_cb(varargin)">history_cb</a>,i});
1284         <span class="keyword">end</span>
1285         hist_menus(num_hist+1) = uimenu(hist_cm,<span class="keyword">...</span>
1286             <span class="string">'Label'</span>,<span class="string">'Clear Menu'</span>,<span class="keyword">...</span>
1287             <span class="string">'Separator'</span>,<span class="string">'on'</span>,<span class="keyword">...</span>
1288             <span class="string">'Callback'</span>,@<a href="#_sub26" class="code" title="subfunction clear_history(varargin)">clear_history</a>);
1289         hist_menus(num_hist+2) = uimenu(hist_cm,<span class="string">'Label'</span>,<span class="keyword">...</span>
1290             sprintf(<span class="string">'Set Number of Recent Folders (%d) ...'</span>,history_size),<span class="keyword">...</span>
1291             <span class="string">'Callback'</span>,@<a href="#_sub27" class="code" title="subfunction set_history_size(varargin)">set_history_size</a>);
1292     <span class="keyword">end</span>
1293 
1294 <span class="keyword">end</span>
1295 
1296 
1297 <span class="comment">% -------------------- Subfunctions --------------------</span>
1298 
1299 <a name="_sub31" href="#_subfunctions" class="code">function [c,network_vol] = path2cell(p)</a>
1300 <span class="comment">% Turns a path string into a cell array of path elements.</span>
1301 <span class="keyword">if</span> ispc
1302     p = strrep(p,<span class="string">'/'</span>,<span class="string">'\'</span>);
1303     c1 = regexp(p,<span class="string">'(^\\\\[^\\]+\\[^\\]+)|(^[A-Za-z]+:)|[^\\]+'</span>,<span class="string">'match'</span>);
1304     vol = c1{1};
1305     c = [{<span class="string">'My Computer'</span>};c1(:)];
1306     <span class="keyword">if</span> strncmp(vol,<span class="string">'\\'</span>,2)
1307         network_vol = vol;
1308     <span class="keyword">else</span>
1309         network_vol = <span class="string">''</span>;
1310     <span class="keyword">end</span>
1311 <span class="keyword">else</span>
1312     c = textscan(p,<span class="string">'%s'</span>,<span class="string">'delimiter'</span>,<span class="string">'/'</span>);
1313     c = [{filesep};c{1}(2:end)];
1314     network_vol = <span class="string">''</span>;
1315 <span class="keyword">end</span>
1316 <span class="keyword">end</span>
1317 
1318 <span class="comment">% --------------------</span>
1319 
1320 <a name="_sub32" href="#_subfunctions" class="code">function p = cell2path(c)</a>
1321 <span class="comment">% Turns a cell array of path elements into a path string.</span>
1322 <span class="keyword">if</span> ispc
1323     p = fullfile(c{2:end},<span class="string">''</span>);
1324 <span class="keyword">else</span>
1325     p = fullfile(c{:},<span class="string">''</span>);
1326 <span class="keyword">end</span>
1327 <span class="keyword">end</span>
1328 
1329 <span class="comment">% --------------------</span>
1330 
1331 <a name="_sub33" href="#_subfunctions" class="code">function d = filtered_dir(full_filter,re_filter,filter_both,sort_fcn)</a>
1332 <span class="comment">% Like dir, but applies filters and sorting.</span>
1333 p = fileparts(full_filter);
1334 <span class="keyword">if</span> isempty(p) &amp;&amp; full_filter(1) == <span class="string">'/'</span>
1335     p = <span class="string">'/'</span>;
1336 <span class="keyword">end</span>
1337 <span class="keyword">if</span> exist(full_filter,<span class="string">'dir'</span>)
1338     dfiles = dir(<span class="string">' '</span>);
1339 <span class="keyword">else</span>
1340     dfiles = dir(full_filter);
1341 <span class="keyword">end</span>
1342 <span class="keyword">if</span> ~isempty(dfiles)
1343     dfiles([dfiles.isdir]) = [];
1344 <span class="keyword">end</span>
1345 
1346 ddir = dir(p);
1347 ddir = ddir([ddir.isdir]);
1348 [unused,index0] = sort(lower({ddir.name})); <span class="comment">%#ok&lt;ASGLU&gt;</span>
1349 ddir = ddir(index0);
1350 ddir(strcmp({ddir.name},<span class="string">'.'</span>) | strcmp({ddir.name},<span class="string">'..'</span>)) = [];
1351 
1352 <span class="comment">% Additional regular expression filter.</span>
1353 <span class="keyword">if</span> nargin &gt; 1 &amp;&amp; ~isempty(re_filter)
1354     <span class="keyword">if</span> ispc || ismac
1355         no_match = cellfun(<span class="string">'isempty'</span>,regexpi({dfiles.name},re_filter));
1356     <span class="keyword">else</span>
1357         no_match = cellfun(<span class="string">'isempty'</span>,regexp({dfiles.name},re_filter));
1358     <span class="keyword">end</span>
1359     dfiles(no_match) = [];
1360 <span class="keyword">end</span>
1361 <span class="keyword">if</span> filter_both
1362     <span class="keyword">if</span> nargin &gt; 1 &amp;&amp; ~isempty(re_filter)
1363         <span class="keyword">if</span> ispc || ismac
1364             no_match = cellfun(<span class="string">'isempty'</span>,regexpi({ddir.name},re_filter));
1365         <span class="keyword">else</span>
1366             no_match = cellfun(<span class="string">'isempty'</span>,regexp({ddir.name},re_filter));
1367         <span class="keyword">end</span>
1368         ddir(no_match) = [];
1369     <span class="keyword">end</span>
1370 <span class="keyword">end</span>
1371 <span class="comment">% Set navigator style:</span>
1372 <span class="comment">%    1 =&gt; list all folders before all files, case-insensitive sorting</span>
1373 <span class="comment">%    2 =&gt; mix files and folders, case-insensitive sorting</span>
1374 <span class="comment">%    3 =&gt; list all folders before all files, case-sensitive sorting</span>
1375 nav_style = 1;
1376 <span class="keyword">switch</span> nav_style
1377     <span class="keyword">case</span> 1
1378         [unused,index1] = sort_fcn(dfiles); <span class="comment">%#ok&lt;ASGLU&gt;</span>
1379         [unused,index2] = sort_fcn(ddir); <span class="comment">%#ok&lt;ASGLU&gt;</span>
1380         d = [ddir(index2);dfiles(index1)];
1381     <span class="keyword">case</span> 2
1382         d = [dfiles;ddir];
1383         [unused,index] = sort(lower({d.name})); <span class="comment">%#ok&lt;ASGLU&gt;</span>
1384         d = d(index);
1385     <span class="keyword">case</span> 3
1386         [unused,index1] = sort({dfiles.name}); <span class="comment">%#ok&lt;ASGLU&gt;</span>
1387         [unused,index2] = sort({ddir.name}); <span class="comment">%#ok&lt;ASGLU&gt;</span>
1388         d = [ddir(index2);dfiles(index1)];
1389 <span class="keyword">end</span>
1390 <span class="keyword">end</span>
1391 
1392 <span class="comment">% --------------------</span>
1393 
1394 <a name="_sub34" href="#_subfunctions" class="code">function [files_sorted,index] = file_sort(files,sort_state)</a>
1395 <span class="keyword">switch</span> find(sort_state)
1396     <span class="keyword">case</span> 1
1397         [files_sorted,index] = sort(lower({files.name}));
1398         <span class="keyword">if</span> sort_state(1) &lt; 0
1399             files_sorted = files_sorted(end:-1:1);
1400             index = index(end:-1:1);
1401         <span class="keyword">end</span>
1402     <span class="keyword">case</span> 2
1403         <span class="keyword">if</span> sort_state(2) &gt; 0
1404             [files_sorted,index] = sort([files.datenum]);
1405         <span class="keyword">else</span>
1406             [files_sorted,index] = sort([files.datenum],<span class="string">'descend'</span>);
1407         <span class="keyword">end</span>
1408     <span class="keyword">case</span> 3
1409         <span class="keyword">if</span> sort_state(3) &gt; 0
1410             [files_sorted,index] = sort([files.bytes]);
1411         <span class="keyword">else</span>
1412             [files_sorted,index] = sort([files.bytes],<span class="string">'descend'</span>);
1413         <span class="keyword">end</span>
1414 <span class="keyword">end</span>
1415 <span class="keyword">end</span>
1416 
1417 <span class="comment">% --------------------</span>
1418 
1419 <a name="_sub35" href="#_subfunctions" class="code">function drives = getdrives(other_drives)</a>
1420 <span class="comment">% Returns a cell array of drive names on Windows.</span>
1421 letters = char(<span class="string">'A'</span>:<span class="string">'Z'</span>);
1422 num_letters = length(letters);
1423 drives = cell(1,num_letters);
1424 <span class="keyword">for</span> i = 1:num_letters
1425     <span class="keyword">if</span> exist([letters(i),<span class="string">':\'</span>],<span class="string">'dir'</span>);
1426         drives{i} = [letters(i),<span class="string">':'</span>];
1427     <span class="keyword">end</span>
1428 <span class="keyword">end</span>
1429 drives(cellfun(<span class="string">'isempty'</span>,drives)) = [];
1430 <span class="keyword">if</span> nargin &gt; 0 &amp;&amp; iscellstr(other_drives)
1431     drives = [drives,unique(other_drives)];
1432 <span class="keyword">end</span>
1433 <span class="keyword">end</span>
1434 
1435 <span class="comment">% --------------------</span>
1436 
1437 <a name="_sub36" href="#_subfunctions" class="code">function filenames = annotate_file_names(filenames,dir_listing,fsdata)</a>
1438 <span class="comment">% Adds a trailing filesep character to folder names and, optionally,</span>
1439 <span class="comment">% prepends a folder icon or bullet symbol.</span>
1440 <span class="keyword">for</span> i = 1:length(filenames)
1441     <span class="keyword">if</span> dir_listing(i).isdir
1442         filenames{i} = sprintf(<span class="string">'%s%s%s%s'</span>,fsdata.pre,filenames{i},<span class="keyword">...</span>
1443             fsdata.filesep,fsdata.post);
1444     <span class="keyword">end</span>
1445 <span class="keyword">end</span>
1446 <span class="keyword">end</span>
1447 
1448 <span class="comment">% --------------------</span>
1449 
1450 <a name="_sub37" href="#_subfunctions" class="code">function history = update_history(history,current_dir,time,history_size)</a>
1451 <span class="keyword">if</span> ~isempty(current_dir)
1452     <span class="comment">% Insert or move current_dir to the top of the history.</span>
1453     <span class="comment">% If current_dir already appears in the history list, delete it.</span>
1454     match = strcmp({history.name},current_dir);
1455     history(match) = [];
1456     <span class="comment">% Prepend history with (current_dir,time).</span>
1457     history = [struct(<span class="string">'name'</span>,current_dir,<span class="string">'time'</span>,time),history];
1458 <span class="keyword">end</span>
1459 <span class="comment">% Trim history to keep at most &lt;history_size&gt; newest entries.</span>
1460 history = history(1:min(history_size,end));
1461 <span class="keyword">end</span>
1462 
1463 <span class="comment">% --------------------</span>
1464 
1465 <a name="_sub38" href="#_subfunctions" class="code">function success = generate_folder_icon(icon_path)</a>
1466 <span class="comment">% Black = 1, manila color = 2, transparent = 3.</span>
1467 im = [ <span class="keyword">...</span>
1468     3 3 3 1 1 1 1 3 3 3 3 3;
1469     3 3 1 2 2 2 2 1 3 3 3 3;
1470     3 1 1 1 1 1 1 1 1 1 1 3;
1471     1 2 2 2 2 2 2 2 2 2 2 1;
1472     1 2 2 2 2 2 2 2 2 2 2 1;
1473     1 2 2 2 2 2 2 2 2 2 2 1;
1474     1 2 2 2 2 2 2 2 2 2 2 1;
1475     1 2 2 2 2 2 2 2 2 2 2 1;
1476     1 2 2 2 2 2 2 2 2 2 2 1;
1477     1 1 1 1 1 1 1 1 1 1 1 1];
1478 cmap = [0 0 0;255 220 130;255 255 255]/255;
1479 fid = fopen(icon_path,<span class="string">'w'</span>);
1480 <span class="keyword">if</span> fid &gt; 0
1481     fclose(fid);
1482     imwrite(im,cmap,icon_path,<span class="string">'Transparency'</span>,[1 1 0])
1483 <span class="keyword">end</span>
1484 success = exist(icon_path,<span class="string">'file'</span>);
1485 <span class="keyword">end</span>
1486 
1487 <span class="comment">% --------------------</span>
1488 
1489 <a name="_sub39" href="#_subfunctions" class="code">function fsdata = set_folder_style(folder_style_pref)</a>
1490 <span class="comment">% Set style to preference.</span>
1491 fsdata.style = folder_style_pref;
1492 <span class="comment">% If style = 1, check to make sure icon image file exists.  If it doesn't,</span>
1493 <span class="comment">% try to create it.  If that fails set style = 2.</span>
1494 <span class="keyword">if</span> fsdata.style == 1
1495     icon_path = fullfile(prefdir,<span class="string">'uipickfiles_folder_icon.png'</span>);
1496     <span class="keyword">if</span> ~exist(icon_path,<span class="string">'file'</span>)
1497         success = <a href="#_sub38" class="code" title="subfunction success = generate_folder_icon(icon_path)">generate_folder_icon</a>(icon_path);
1498         <span class="keyword">if</span> ~success
1499             fsdata.style = 2;
1500         <span class="keyword">end</span>
1501     <span class="keyword">end</span>
1502 <span class="keyword">end</span>
1503 <span class="comment">% Set pre and post fields.</span>
1504 <span class="keyword">if</span> fsdata.style == 1
1505     icon_url = [<span class="string">'file://localhost/'</span>,<span class="keyword">...</span>
1506         strrep(strrep(icon_path,<span class="string">':'</span>,<span class="string">'|'</span>),<span class="string">'\'</span>,<span class="string">'/'</span>)];
1507     fsdata.pre = sprintf(<span class="string">'&lt;html&gt;&lt;img src=&quot;%s&quot;&gt;&amp;nbsp;'</span>,icon_url);
1508     fsdata.post = <span class="string">'&lt;/html&gt;'</span>;
1509 <span class="keyword">elseif</span> fsdata.style == 2
1510     fsdata.pre = <span class="string">'&lt;html&gt;&lt;b&gt;&amp;#8226;&lt;/b&gt;&amp;nbsp;'</span>;
1511     fsdata.post = <span class="string">'&lt;/html&gt;'</span>;
1512 <span class="keyword">elseif</span> fsdata.style == 3
1513     fsdata.pre = <span class="string">''</span>;
1514     fsdata.post = <span class="string">''</span>;
1515 <span class="keyword">end</span>
1516 fsdata.filesep = filesep;
1517 
1518 <span class="keyword">end</span>
1519 
1520 <span class="comment">% --------------------</span>
1521 
1522 <a name="_sub40" href="#_subfunctions" class="code">function prop = parsepropval(prop,varargin)</a>
1523 <span class="comment">% Parse property/value pairs and return a structure.</span>
1524 properties = fieldnames(prop);
1525 arg_index = 1;
1526 <span class="keyword">while</span> arg_index &lt;= length(varargin)
1527     arg = varargin{arg_index};
1528     <span class="keyword">if</span> ischar(arg)
1529         prop_index = <a href="#_sub41" class="code" title="subfunction prop_index = match_property(arg,properties)">match_property</a>(arg,properties);
1530         prop.(properties{prop_index}) = varargin{arg_index + 1};
1531         arg_index = arg_index + 2;
1532     <span class="keyword">elseif</span> isstruct(arg)
1533         arg_fn = fieldnames(arg);
1534         <span class="keyword">for</span> i = 1:length(arg_fn)
1535             prop_index = <a href="#_sub41" class="code" title="subfunction prop_index = match_property(arg,properties)">match_property</a>(arg_fn{i},properties);
1536             prop.(properties{prop_index}) = arg.(arg_fn{i});
1537         <span class="keyword">end</span>
1538         arg_index = arg_index + 1;
1539     <span class="keyword">else</span>
1540         error([<span class="string">'Properties must be specified by property/value pairs'</span>,<span class="keyword">...</span>
1541             <span class="string">' or structures.'</span>])
1542     <span class="keyword">end</span>
1543 <span class="keyword">end</span>
1544 <span class="keyword">end</span>
1545 
1546 <span class="comment">% --------------------</span>
1547 
1548 <a name="_sub41" href="#_subfunctions" class="code">function prop_index = match_property(arg,properties)</a>
1549 <span class="comment">% Utility function for parsepropval.</span>
1550 prop_index = find(strcmpi(arg,properties));
1551 <span class="keyword">if</span> isempty(prop_index)
1552     prop_index = find(strncmpi(arg,properties,length(arg)));
1553 <span class="keyword">end</span>
1554 <span class="keyword">if</span> length(prop_index) ~= 1
1555     error(<span class="string">'Property ''%s'' does not exist or is ambiguous.'</span>,arg)
1556 <span class="keyword">end</span>
1557 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Tue 24-Jan-2017 12:45:06 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2005</address>
</body>
</html>